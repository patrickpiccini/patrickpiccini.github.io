<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Posts on Patrick Piccini</title>
        <link>https://patrickpiccini.github.io/posts/</link>
        <description>Recent content in Posts on Patrick Piccini</description>
        <generator>Hugo -- gohugo.io</generator>
        <language>en-us</language>
        <copyright>This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.</copyright>
        <lastBuildDate>Tue, 21 Jun 2022 20:00:52 -0100</lastBuildDate>
        <atom:link href="https://patrickpiccini.github.io/posts/index.xml" rel="self" type="application/rss+xml" />
        
        <item>
            <title>Predi√ß√£o de Insufici√™ncia Cardiaca</title>
            <link>https://patrickpiccini.github.io/posts/predicao_de_insuficiencia_cardiaca/</link>
            <pubDate>Tue, 21 Jun 2022 20:00:52 -0100</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/predicao_de_insuficiencia_cardiaca/</guid>
            <description>Table of Contents  DataSet Compreendendo o problema  Informa√ß√µes de atributo   Configura√ß√£o Inicial Explora√ß√£o Limpeza Discretiza√ß√£o Visualiza√ß√£o Quais atributos tem rela√ß√£o? Distribui√ß√£o de algumas colunas do DataSet Calculo de Insufici√™ncia Cardiaca Inicio de Treinamento de Modelos  Separa√ß√£o de Dados   Desision Tree  Medidas de sele√ß√£o de atributo   Randon Fores Logistic Regression GaussianNB  Calculo do algoritmo   Matriz Confus√£o Cross-Validation Curva ROC Insigths   Projeto GitHub heart-failure-prediction</description>
            <content type="html"><![CDATA[<p><img src="http://www.bancodasaude.com/cdn/infosaude/article/insuficiencia-cardiaca.jpg" alt="&ldquo;img&rdquo;"></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#dataset">DataSet</a></li>
<li><a href="#compreendendo-o-problema">Compreendendo o problema</a>
<ul>
<li><a href="#informa%C3%A7%C3%B5es-de-atributo">Informa√ß√µes de atributo</a></li>
</ul>
</li>
<li><a href="#configura%C3%A7%C3%A3o-inicial">Configura√ß√£o Inicial</a></li>
<li><a href="#explora%C3%A7%C3%A3o">Explora√ß√£o</a></li>
<li><a href="#limpeza">Limpeza</a></li>
<li><a href="#discretiza%C3%A7%C3%A3o">Discretiza√ß√£o</a></li>
<li><a href="#visualiza%C3%A7%C3%A3o">Visualiza√ß√£o</a></li>
<li><a href="#quais-atributos-tem-rela%C3%A7%C3%A3o">Quais atributos tem rela√ß√£o?</a></li>
<li><a href="#distribui%C3%A7%C3%A3o-de-algumas-colunas-do-dataset">Distribui√ß√£o de algumas colunas do DataSet</a></li>
<li><a href="#calculo-de-insufici%C3%AAncia-cardiaca">Calculo de Insufici√™ncia Cardiaca</a></li>
<li><a href="#inicio-de-treinamento-de-modelos">Inicio de Treinamento de Modelos</a>
<ul>
<li><a href="#separa%C3%A7%C3%A3o-de-dados">Separa√ß√£o de Dados</a></li>
</ul>
</li>
<li><a href="#---------desision-tree-train---------">Desision Tree</a>
<ul>
<li><a href="#medidas-de-sele%C3%A7%C3%A3o-de-atributo">Medidas de sele√ß√£o de atributo</a></li>
</ul>
</li>
<li><a href="#---------randon-forest-train---------">Randon Fores</a></li>
<li><a href="#---------logistic-regression-train---------">Logistic Regression</a></li>
<li><a href="#---------gaussiannb-train---------">GaussianNB</a>
<ul>
<li><a href="#calculo-do-algoritmo">Calculo do algoritmo</a></li>
</ul>
</li>
<li><a href="#matriz-confus%C3%A3o">Matriz Confus√£o</a></li>
<li><a href="#cross-validation">Cross-Validation</a></li>
<li><a href="#curva-roc">Curva ROC</a></li>
<li><a href="#insigths">Insigths</a></li>
</ul>
<hr>
<h2 id="projeto-github">Projeto GitHub</h2>
<p><a href="https://github.com/patrickpiccini/heart-failure-prediction">heart-failure-prediction</a></p>
<p>Ol√°, meu nome √© Patrick Piccini, e seja bem vindo a mais um projeto de Data Science.</p>
<p>O que iremos ver nesse Projeto:</p>
<ul>
<li>üìö DataSet</li>
<li>üß† Compreendendo o problema</li>
<li>‚õè Analise Exploratoria de Dados</li>
<li>üé≤ Manipula√ß√£o de dados</li>
<li>üìä Visualiza√ß√£o de dados</li>
<li>üßÆ Algoritmos de Classifica√ß√£o</li>
<li>üò± Insigths</li>
</ul>
<h2 id="dataset">DataSet</h2>
<p><a href="https://www.kaggle.com/datasets/fedesoriano/heart-failure-prediction">Heart Failure Prediction Dataset - Kaggle</a></p>
<h2 id="compreendendo-o-problema">Compreendendo o problema</h2>
<p>As doen√ßas cardiovasculares (DCVs) s√£o a causa n√∫mero 1 de morte em todo o mundo, levando cerca de 17,9 milh√µes de vidas a cada ano, o que representa 31% de todas as mortes em todo o mundo. Quatro das mortes por 5CVD s√£o devido a ataques card√≠acos e derrames, e um ter√ßo dessas mortes ocorre prematuramente em pessoas com menos de 70 anos de idade. A insufici√™ncia card√≠aca √© um evento comum causado por DCV e este conjunto de dados cont√©m 11 caracter√≠sticas que podem ser usadas para prever uma poss√≠vel doen√ßa card√≠aca.</p>
<p>Pessoas com doen√ßa cardiovascular ou com alto risco cardiovascular (devido √† presen√ßa de um ou mais fatores de risco, como hipertens√£o, diabetes, hiperlipidemia ou doen√ßa j√° estabelecida) precisam de detec√ß√£o e gerenciamento precoces, onde um modelo de aprendizado de m√°quina pode ser de grande ajuda.</p>
<p><img src="https://lh3.googleusercontent.com/LkeF783CO8iu1R8Q3fB-Kqo9L2x6FWcEYa-5NijcXqgNjaD3gCuixMwzW9ciVlikGNrdI1c1_uemz7xCeqV7I8DCKjl9ZmcKXt3ql9A4Bd-DmIfKZbDFp-yI8O0uvlorXYSbrkuL=s0" alt="&ldquo;img&rdquo;"></p>
<h3 id="informa√ß√µes-de-atributo">Informa√ß√µes de atributo</h3>
<ul>
<li><strong>Age:</strong> idade do paciente [anos]</li>
<li><strong>Sex:</strong> sexo do paciente [M: Masculino, F: Feminino]</li>
<li><strong>ChestPainType:</strong> tipo de dor no peito [TA: Angina T√≠pica, ATA: Angina At√≠pica, NAP: Dor N√£o Anginosa, ASY: Assintom√°tica]</li>
<li><strong>RestingBP:</strong> press√£o arterial de repouso [mm Hg]</li>
<li><strong>Cholesterol:</strong> colesterol s√©rico [mm/dl]</li>
<li><strong>FastingBS:</strong> glicemia em jejum [1: se FastingBS &gt; 120 mg/dl, 0: caso contr√°rio]</li>
<li><strong>RestingECG:</strong> resultados do eletrocardiograma de repouso [Normal: normal, ST: com anormalidade da onda ST-T (invers√µes da onda T e/ou eleva√ß√£o ou depress√£o do ST &gt; 0,05 mV), HVE: mostrando prov√°vel ou definitiva hipertrofia ventricular esquerda pelos crit√©rios de Estes]</li>
<li><strong>MaxHR:</strong> frequ√™ncia card√≠aca m√°xima alcan√ßada [Valor num√©rico entre 60 e 202]</li>
<li>**ExerciseAngina: angina induzida por exerc√≠cio [S: Sim, N: N√£o]</li>
<li><strong>Oldpeak:</strong> pico antigo = ST [Valor num√©rico medido em depress√£o]</li>
<li><strong>ST_Slope:</strong> inclina√ß√£o do segmento ST do exerc√≠cio de pico [Up: upsloping, Flat: flat, Down: downsloping]</li>
<li><strong>HeartDisease:</strong> classe de sa√≠da [1: doen√ßa card√≠aca, 0: normal]</li>
</ul>
<h2 id="configura√ß√£o-inicial">Configura√ß√£o Inicial</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> numpy <span style="color:#f92672">as</span> np 
<span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">from</span> sklearn <span style="color:#f92672">import</span> tree
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> sklearn.naive_bayes <span style="color:#f92672">import</span> GaussianNB
<span style="color:#f92672">from</span> sklearn.tree <span style="color:#f92672">import</span> DecisionTreeClassifier
<span style="color:#f92672">from</span> sklearn.model_selection <span style="color:#f92672">import</span> train_test_split, cross_val_score
<span style="color:#f92672">from</span> sklearn.linear_model <span style="color:#f92672">import</span> LogisticRegression
<span style="color:#f92672">from</span> sklearn.ensemble <span style="color:#f92672">import</span> RandomForestClassifier
<span style="color:#f92672">from</span> sklearn.metrics <span style="color:#f92672">import</span> accuracy_score,precision_score,recall_score,f1_score, classification_report, confusion_matrix, ConfusionMatrixDisplay, RocCurveDisplay, precision_recall_fscore_support

heart_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(<span style="color:#e6db74">&#39;./dataset/heart.csv&#39;</span>, sep<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;,&#39;</span>)
</code></pre></div><ul>
<li>Iremos renomear o nome das colunas para Portugu√™s, onde facilitar√° na hora do entendimento da informa√ß√£o dos dados.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">columns <span style="color:#f92672">=</span> {
    <span style="color:#e6db74">&#39;Age&#39;</span>: <span style="color:#e6db74">&#39;Idade&#39;</span>,
    <span style="color:#e6db74">&#39;Sex&#39;</span>: <span style="color:#e6db74">&#39;Sexo&#39;</span>, 
    <span style="color:#e6db74">&#39;ChestPainType&#39;</span>: <span style="color:#e6db74">&#39;Tipo_Dor_Peito&#39;</span>, 
    <span style="color:#e6db74">&#39;RestingBP&#39;</span>: <span style="color:#e6db74">&#39;RepousoPA&#39;</span>, 
    <span style="color:#e6db74">&#39;Cholesterol&#39;</span>: <span style="color:#e6db74">&#39;Colesterol&#39;</span>, 
    <span style="color:#e6db74">&#39;FastingBS&#39;</span>: <span style="color:#e6db74">&#39;FastingBS&#39;</span>,
    <span style="color:#e6db74">&#39;RestingECG&#39;</span>: <span style="color:#e6db74">&#39;RestingECG&#39;</span>, 
    <span style="color:#e6db74">&#39;MaxHR&#39;</span>: <span style="color:#e6db74">&#39;Frequencia_Cardiaca_Max&#39;</span>, 
    <span style="color:#e6db74">&#39;ExerciseAngina&#39;</span>: <span style="color:#e6db74">&#39;Exercicio_Angina&#39;</span>, 
    <span style="color:#e6db74">&#39;Oldpeak&#39;</span>: <span style="color:#e6db74">&#39;Pico_Antigo&#39;</span>, 
    <span style="color:#e6db74">&#39;ST_Slope&#39;</span>: <span style="color:#e6db74">&#39;ST_Slope&#39;</span>,
    <span style="color:#e6db74">&#39;HeartDisease&#39;</span>: <span style="color:#e6db74">&#39;Doenca_Cardiaca&#39;</span>
}

heart_df <span style="color:#f92672">=</span> heart_df<span style="color:#f92672">.</span>rename(columns<span style="color:#f92672">=</span>columns)
heart_df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">5</span>)
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img1.png" alt="&ldquo;img1&rdquo;"></p>
<h2 id="explora√ß√£o">Explora√ß√£o</h2>
<ul>
<li>Verificaremos a quantidade de colunas e linhas existentes no DataSet.</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Colunas: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> heart_df<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">1</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Linhas: </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> heart_df<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
</code></pre></div><ul>
<li>Colunas: 12</li>
<li>Linhas: 918</li>
</ul>
<p>Com o comando <strong>&ldquo;describe&rdquo;</strong>, iremos obter um resumo de estat√≠sticas descritivas do DataFrame. Isso inclui m√©dia, contagem, desvio padr√£o, percentis e valores m√≠n.-m√°x. de todos os recursos. Com o <strong>&quot;.T&rdquo;</strong> apenas iremos rotacionar o resultado do <strong>&ldquo;describe&rdquo;</strong>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">heart_df<span style="color:#f92672">.</span>describe()<span style="color:#f92672">.</span>T
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img2.png" alt="&ldquo;img2&rdquo;"></p>
<p>Abaixo veremos mais algumas informa√ß√µes referentes a cada coluna do DataFrame.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">heart_df<span style="color:#f92672">.</span>info()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img3.png" alt="&ldquo;img3&rdquo;"></p>
<h2 id="limpeza">Limpeza</h2>
<p>Percebemos que n√£o existem valores NaN em nosso DataSet, por√©m, existem muitos valores do colesterol igual a 0 (Zero). Visto isso, para n√£o perdermos informa√ß√µes, substituiremos os valores de 0 (Zero) para um valor &ldquo;Saud√°vel&rdquo; sendo 130.</p>
<p>Para termos uma visualiza√ß√£o de como ir√° influenciar a limpeza de dados, iremos salvar os dois estados da coluna colesterol, para posteriormente plotarmos um grafico.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(heart_df<span style="color:#f92672">.</span>notna()<span style="color:#f92672">.</span>value_counts())
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img4.png" alt="&ldquo;img4&rdquo;"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">colesterol_0 <span style="color:#f92672">=</span> heart_df<span style="color:#f92672">.</span>Colesterol
heart_df<span style="color:#f92672">.</span>Colesterol <span style="color:#f92672">=</span> heart_df<span style="color:#f92672">.</span>Colesterol<span style="color:#f92672">.</span>replace(<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">130</span>)
colesterol_no_0 <span style="color:#f92672">=</span> heart_df<span style="color:#f92672">.</span>Colesterol
</code></pre></div><h2 id="discretiza√ß√£o">Discretiza√ß√£o</h2>
<p>Formar conjuntos de idade para classifica√ß√£o.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Idade m√°xima: &#39;</span>,heart_df<span style="color:#f92672">.</span>Idade<span style="color:#f92672">.</span>max())
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Idade MINIMA: &#39;</span>,heart_df<span style="color:#f92672">.</span>Idade<span style="color:#f92672">.</span>min())
</code></pre></div><ul>
<li>Idade m√°xima:  77</li>
<li>Idade MINIMA:  28</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">bins <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">12</span>,<span style="color:#ae81ff">20</span>,<span style="color:#ae81ff">60</span>,<span style="color:#ae81ff">100</span>]
labels <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;crianca&#39;</span>,<span style="color:#e6db74">&#39;adolecente&#39;</span>,<span style="color:#e6db74">&#39;adulto&#39;</span>,<span style="color:#e6db74">&#39;idoso&#39;</span>]
conjuto_idade <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>cut(heart_df[<span style="color:#e6db74">&#39;Idade&#39;</span>]<span style="color:#f92672">.</span>to_numpy(), bins<span style="color:#f92672">=</span>bins, labels<span style="color:#f92672">=</span>labels)

heart_df[<span style="color:#e6db74">&#39;conjunto_idade&#39;</span>] <span style="color:#f92672">=</span> conjuto_idade

heart_df<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">3</span>)
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img5.png" alt="&ldquo;img5&rdquo;"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">heart_df<span style="color:#f92672">.</span>conjunto_idade<span style="color:#f92672">.</span>value_counts()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img6.png" alt="&ldquo;img6&rdquo;"></p>
<h1 id="visualiza√ß√£o">Visualiza√ß√£o</h1>
<p>Nesse passo da AED iremos plotar alguns gr√°ficos onde consiguiremos ter uma an√°lise das informa√ß√µes um pouco mais din√¢mica, e com isso conseguiremos criar alguns insigths de nossas informa√ß√µes</p>
<ul>
<li>Iremos calcular a porcentagem de casos de pessoas com Insufici√™ncia Card√≠acas e sem Insufici√™ncia Card√≠a</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;paciente com Insufici√™ncia Cardiacas:&#34;</span>, heart_df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;Doenca_Cardiaca == 1&#39;</span>)<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;paciente sem Insufici√™ncia Cardiaca:&#34;</span>, heart_df<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;Doenca_Cardiaca == 0&#39;</span>)<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>])

labels <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>]
sizes <span style="color:#f92672">=</span> heart_df[<span style="color:#e6db74">&#39;Doenca_Cardiaca&#39;</span>]<span style="color:#f92672">.</span>value_counts()
explode <span style="color:#f92672">=</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0.1</span>, <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>)

fig1, ax1 <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots()
ax1<span style="color:#f92672">.</span>pie(sizes, labels<span style="color:#f92672">=</span>labels, autopct<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">%1.1f%%</span><span style="color:#e6db74">&#39;</span>,shadow<span style="color:#f92672">=</span>True, startangle<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span> ,colors<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#E74C3C&#39;</span>,<span style="color:#e6db74">&#39;#3498DB&#39;</span>])
ax1<span style="color:#f92672">.</span>axis(<span style="color:#e6db74">&#39;equal&#39;</span>)  <span style="color:#75715e"># Equal aspect ratio ensures that pie is drawn as a circle.</span>
plt<span style="color:#f92672">.</span>show()
</code></pre></div><ul>
<li>paciente com Insufici√™ncia Cardiacas: 508</li>
<li>paciente sem Insufici√™ncia Cardiaca: 410</li>
</ul>
<p><img src="/images/insuficiencia_cardiaca/img7.png" alt="&ldquo;img7&rdquo;"></p>
<h2 id="quais-atributos-tem-rela√ß√£o">Quais atributos tem rela√ß√£o?</h2>
<p>Atrav√©s de uma HeatMap (Mapa de calor), verificaremos quais as rela√ß√µes que os atributos tem com a coluna alvo, que no nosso caso √© a _DoencaCardiaca</p>
<p>Podemos ver que a Doen√ßa Card√≠aca tem grande rela√ß√£o com uma &ldquo;Pico_Antigo&rdquo; alta e tambem uma rela√ß√£o com &ldquo;Idade&rdquo;. H√° uma rela√ß√£o boa com &ldquo;&quot;,&ldquo;FastingBS&rdquo; e &ldquo;RepousoPA&rdquo;.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>,<span style="color:#ae81ff">6</span>))

sns<span style="color:#f92672">.</span>heatmap(heart_df<span style="color:#f92672">.</span>corr(), annot<span style="color:#f92672">=</span>True, cmap <span style="color:#f92672">=</span><span style="color:#e6db74">&#34;RdYlBu&#34;</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img8.png" alt="&ldquo;img8&rdquo;"></p>
<h2 id="distribui√ß√£o-de-algumas-colunas-do-dataset">Distribui√ß√£o de algumas colunas do DataSet</h2>
<p>Vendo os gr√°ficos plotados, conseguimos perceber o volume de informa√ß√µes sobre determinado valor, de acordo com sua coluna.</p>
<p>Uma coisa que podemos notar no gr√°fico do colesterol, √© que h√° uma grande quantidade de dados com o valor 0 ou negativo. Fazendo um pesquisa r√°pida na internet, entende-se que existe certo consenso de que valores do LDL-Colesterol (¬®colesterol ruim‚Äù) menores que 40 mg/dl no sangue s√£o considerados baixos, entretanto, estudos recentes n√£o demonstraram efeitos colaterais graves mesmo quando esse valor foi reduzido at√© 25mg/dl. Sendo assim, esses dados zeros ou negativos certamente est√£o errados, e com isso, podemos trat√°-los como Outliers.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">3</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">10</span>))
sns<span style="color:#f92672">.</span>kdeplot(heart_df[<span style="color:#e6db74">&#39;Idade&#39;</span>], ax <span style="color:#f92672">=</span> axes[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>] ,shade<span style="color:#f92672">=</span>True, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>)
sns<span style="color:#f92672">.</span>kdeplot(heart_df[<span style="color:#e6db74">&#39;RepousoPA&#39;</span>], ax <span style="color:#f92672">=</span> axes[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>], shade<span style="color:#f92672">=</span>True, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;rebeccapurple&#39;</span>)
sns<span style="color:#f92672">.</span>kdeplot(heart_df[<span style="color:#e6db74">&#39;Colesterol&#39;</span>], ax <span style="color:#f92672">=</span> axes[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">2</span>], shade<span style="color:#f92672">=</span>True, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;g&#39;</span>)
sns<span style="color:#f92672">.</span>kdeplot(heart_df[<span style="color:#e6db74">&#39;Frequencia_Cardiaca_Max&#39;</span>], ax <span style="color:#f92672">=</span> axes[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>], shade<span style="color:#f92672">=</span>True, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;darkorange&#39;</span>)
sns<span style="color:#f92672">.</span>kdeplot(heart_df[<span style="color:#e6db74">&#39;Pico_Antigo&#39;</span>], ax <span style="color:#f92672">=</span> axes[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>], shade<span style="color:#f92672">=</span>True, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;blue&#39;</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img9.png" alt="&ldquo;img9&rdquo;"></p>
<p>Antes de continuarmos, vamos ver a diferen√ßa dos gr√°ficos referente ao Colesterol, visto que tivemos alguns valores modificados no passo de Limpeza dos dados. Apenas relembrando, trocamos os valores 0 do colesterol, para um valor &ldquo;saud√°vel&rdquo;, sendo esse 130.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">10</span>, <span style="color:#ae81ff">5</span>))
sns<span style="color:#f92672">.</span>kdeplot(colesterol_0, ax <span style="color:#f92672">=</span> axes[<span style="color:#ae81ff">0</span>], shade<span style="color:#f92672">=</span>True, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;r&#39;</span>)
sns<span style="color:#f92672">.</span>kdeplot(colesterol_no_0, ax <span style="color:#f92672">=</span> axes[<span style="color:#ae81ff">1</span>], shade<span style="color:#f92672">=</span>True, color<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;g&#39;</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img10.png" alt="&ldquo;img10&rdquo;"></p>
<h2 id="calculo-de-insufici√™ncia-cardiaca">Calculo de Insufici√™ncia Cardiaca</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, axes <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">3</span>, <span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">20</span>, <span style="color:#ae81ff">10</span>))

sns<span style="color:#f92672">.</span>countplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Sexo&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Doenca_Cardiaca&#34;</span>, data<span style="color:#f92672">=</span>heart_df, ax<span style="color:#f92672">=</span>axes[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">0</span>] ,palette<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#3498DB&#39;</span>,<span style="color:#e6db74">&#39;#E74C3C&#39;</span>])
sns<span style="color:#f92672">.</span>countplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Tipo_Dor_Peito&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Doenca_Cardiaca&#34;</span>, data<span style="color:#f92672">=</span>heart_df, ax<span style="color:#f92672">=</span>axes[<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1</span>] ,palette<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#3498DB&#39;</span>,<span style="color:#e6db74">&#39;#E74C3C&#39;</span>])
sns<span style="color:#f92672">.</span>countplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;RestingECG&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Doenca_Cardiaca&#34;</span>, data<span style="color:#f92672">=</span>heart_df, ax<span style="color:#f92672">=</span>axes[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">0</span>] ,palette<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#3498DB&#39;</span>,<span style="color:#e6db74">&#39;#E74C3C&#39;</span>])
sns<span style="color:#f92672">.</span>countplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;ST_Slope&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Doenca_Cardiaca&#34;</span>, data<span style="color:#f92672">=</span>heart_df, ax<span style="color:#f92672">=</span>axes[<span style="color:#ae81ff">1</span>, <span style="color:#ae81ff">1</span>] ,palette<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#3498DB&#39;</span>,<span style="color:#e6db74">&#39;#E74C3C&#39;</span>])
sns<span style="color:#f92672">.</span>countplot(x<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;conjunto_idade&#34;</span>, hue<span style="color:#f92672">=</span><span style="color:#e6db74">&#34;Doenca_Cardiaca&#34;</span>, data<span style="color:#f92672">=</span>heart_df, ax<span style="color:#f92672">=</span>axes[<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">0</span>] ,palette<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;#3498DB&#39;</span>,<span style="color:#e6db74">&#39;#E74C3C&#39;</span>])
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img11.png" alt="&ldquo;img11&rdquo;"></p>
<h3 id="grafico-sexo">Grafico Sexo</h3>
<p>odemos perceber que Homens tem maiores chances de ter Insuficiencia Card√≠aca mesmo que tenham maior volume de dados. J√° as Mulheres tem grandes chances de N√ÉO ter algum problema card√≠aco. Nota-se que os valores de casos sem a doen√ßa chega a ser 3/4 do conjunto de Mulheres</p>
<h3 id="grafico-tipo-de-dor-no-peito">Grafico Tipo de dor no peito</h3>
<ul>
<li>TA: Angina T√≠pica, ATA: Angina At√≠pica, NAP: Dor N√£o Anginosa, ASY: Assintom√°tica</li>
</ul>
<p>Nota-se que de toda a classe Tipo_Dor_Peito a que mais se destaca √© o classificador ASY, que representa uma dor Assintom√°tica, em outras palavras, uma dor com poucos sintomas, ou pouco visivel. Vemos que o risco de ter insufici√™ncia cardiaca √© extremamente alta contendo esse tipo de dor.</p>
<p>No tipo TA, mesmo tendo um pequeno volume de dados, percebe-se que a quantidade de casos com e sem insufici√™ncia √© quase balanceado. Para esses casos deve-se ter mais aten√ß√£o na hora dos diagn√≥sticos para que o paciente n√£o seja classificado sem a doen√ßa cardiaca.</p>
<p>Devemos perceber que nos tipos NAP e ATA temos um menor volume de dados contendo Insufici√™ncia Card√≠aca comparado com ASY e TA.</p>
<h3 id="restingecg">RestingECG</h3>
<ul>
<li>Resultados do eletrocardiograma de repouso
[Normal: normal, ST: com anormalidade da onda ST-T (invers√µes da onda T e/ou eleva√ß√£o ou depress√£o do ST &gt; 0,05 mV), HVE: mostrando prov√°vel ou definitiva hipertrofia ventricular esquerda pelos crit√©rios de Estes]</li>
</ul>
<p>dentifica-se que a maioria dos pacientes, independente do resultado do eletrocardiograma, possuem chances de ter algum problema card√≠aco.</p>
<h3 id="grafico-st_stope">Grafico ST_Stope</h3>
<ul>
<li>Exame de Teste de Esfor√ßo</li>
<li>ST_Slope: inclina√ß√£o do segmento ST do exerc√≠cio de pico [Up: upsloping, Flat: flat, Down: downsloping]</li>
</ul>
<p>Nos resultados do ST_Slope pessoas com segmento ST maiores(UP), n√£o tendem a ter insuficiencia cardiaca, visto que os bastimentos est√£o com um BPM alto.</p>
<p>Se mesmo no Teste de esfor√ßo f√≠sico o segmento ST estiver sem muita varia√ß√£o(Flat), a tend√™ncia a ter insufici√™ncia cardiaca √© bem alta. A mesma coisa quando o segmento ST estiver baixo(Down).</p>
<h3 id="conjunto-idade">Conjunto Idade</h3>
<p>O conjunto de idade foi criado na parte de discretiza√ß√£o justamente para categorizar cara pessoa por seu devido conjunto de idade sende eles:</p>
<ul>
<li>[Crian√ßa - 0 √† 12</li>
<li>[Adolecente] - 12 √† 20</li>
<li>[Adulto] - 20 √† 60</li>
<li>[Idoso] - 60 √† 100</li>
</ul>
<p>Como podemos perceber, no DataSet n√£o ha nenhum registro de pessoas da categoria &ldquo;Crian√ßa&rdquo; e &ldquo;Adolecente&rdquo;. Nota-se que a 50% de de todos os Adultos tem alguma insufici√™ncia cardiaca, e tambem cerca de 75% dos Idosos tambem foram diagnosticado com essa doen√ßa.</p>
<p>Iremos retirar a coluna de idade, visto que com a nova coluna de &ldquo;conjunto_idade&rdquo; poderemos utilizar facilmente no treinamento dos modelos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">heart_df<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Idade&#39;</span>], inplace<span style="color:#f92672">=</span>True)
</code></pre></div><h2 id="inicio-de-treinamento-de-modelos">Inicio de Treinamento de Modelos</h2>
<p><img src="https://i0.wp.com/memetizando.com.br/wp-content/uploads/2020/03/meme-eu-na-academia.gif" alt="&ldquo;gif&rdquo;"></p>
<h3 id="separa√ß√£o-de-dados">Separa√ß√£o de Dados</h3>
<p>Antes de come√ßarmos a criar qualquer modelo, precisaremos separar os dados do Dataframe em dois grupos, um de Treino e outro de Teste.</p>
<ul>
<li>
<p>Dados de Treino
Os dados de treino s√£o respons√°veis por serem as informa√ß√µes que o Algoritmo de Machine Learnig usara para a cria√ß√£o de um modelo. No nosso caso utilizamos 70% do DataSet para o treinamento.</p>
</li>
<li>
<p>Dados de Teste
Os dados de teste s√£o aplicados ao modelo criado, simulando previs√µes reais que o modelo realizar√°, fazendo com que seja verificado o desempenho real do modelo. Utilizaremos 30% do DataSet para Teste.</p>
</li>
<li>
<p>Separando dados de Treino e Teste para cria√ß√£o de modelos.</p>
</li>
<li>
<p>Alterando o type das informa√ß√µes para &lsquo;Category&rsquo;.</p>
</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">y <span style="color:#f92672">=</span> heart_df[<span style="color:#e6db74">&#39;Doenca_Cardiaca&#39;</span>]<span style="color:#f92672">.</span>values
heart_df<span style="color:#f92672">.</span>drop(columns<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;Doenca_Cardiaca&#39;</span>], inplace<span style="color:#f92672">=</span>True)

X <span style="color:#f92672">=</span> heart_df

X_train, X_test, y_train, y_test <span style="color:#f92672">=</span> train_test_split(X, y, test_size<span style="color:#f92672">=</span><span style="color:#ae81ff">0.3</span>, random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, stratify<span style="color:#f92672">=</span>y)

<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> X_test<span style="color:#f92672">.</span>columns:
    <span style="color:#66d9ef">if</span> type(X_test[c]<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">==</span> str:
        X_test[c] <span style="color:#f92672">=</span> X_test[c]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;category&#39;</span>)
        X_test[c] <span style="color:#f92672">=</span> X_test[c]<span style="color:#f92672">.</span>cat<span style="color:#f92672">.</span>codes
        
<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> X_train<span style="color:#f92672">.</span>columns:
    <span style="color:#66d9ef">if</span> type(X_train[c]<span style="color:#f92672">.</span>iloc[<span style="color:#ae81ff">0</span>]) <span style="color:#f92672">==</span> str:
        X_train[c] <span style="color:#f92672">=</span> X_train[c]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;category&#39;</span>)
        X_train[c] <span style="color:#f92672">=</span> X_train[c]<span style="color:#f92672">.</span>cat<span style="color:#f92672">.</span>codes
</code></pre></div><h2 id="---------desision-tree-train---------">&mdash;&mdash;&ndash; Desision Tree Train &mdash;&mdash;&ndash;</h2>
<p><img src="https://c.tenor.com/sndiWcujL3kAAAAC/cyanide-and-happiness-ladder.gif" alt=""></p>
<p>O algoritmo √Årvore de Decis√£o pertence √† fam√≠lia de algoritmos de aprendizado SUPERVISIONADO. Ao contr√°rio de outros algoritmos de aprendizado supervisionado, o algoritmo de √°rvore de decis√£o tamb√©m pode ser usado para resolver problemas de regress√£o e classifica√ß√£o . O objetivo de usar uma √Årvore de Decis√£o √© criar um modelo de treinamento que possa ser usado para prever a classe ou valor da vari√°vel de destino aprendendo regras de decis√£o simples inferidas de dados anteriores (dados de treinamento). Em √Årvores de Decis√£o, para prever um r√≥tulo de classe para um registro, come√ßamos da raiz da √°rvore. Comparamos os valores do atributo root com o atributo do registro. Com base na compara√ß√£o, seguimos o ramo correspondente a esse valor e saltamos para o pr√≥ximo n√≥.</p>
<h3 id="medidas-de-sele√ß√£o-de-atributo">Medidas de sele√ß√£o de atributo</h3>
<p>Se o conjunto de dados consiste em N atributos, decidir qual atributo colocar na raiz ou em diferentes n√≠veis da √°rvore como n√≥s internos √© uma etapa complicada. Apenas selecionar aleatoriamente qualquer n√≥ para ser a raiz n√£o pode resolver o problema. Se seguirmos uma abordagem aleat√≥ria, isso pode nos dar resultados ruins com baixa precis√£o.</p>
<p>Nesses cassos usamos alguns crit√©rios para fazer calculos diferentes na hora da distribui√ß√£o, sendo algum deles:</p>
<p><img src="/images/insuficiencia_cardiaca/img12.png" alt="img12"></p>
<ul>
<li><em><strong>p(i/t)</strong></em>  &ndash;&gt; peso = quantia de indice da classe/ quantia todal de indices</li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tree_view <span style="color:#f92672">=</span> DecisionTreeClassifier(criterion<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gini&#39;</span>,random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)

<span style="color:#75715e"># .fit √© o comando de treinamento(lembre de fitness. o que treina)</span>
model <span style="color:#f92672">=</span> tree_view<span style="color:#f92672">.</span>fit(X_train, y_train)
prediction_tree_train <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_train)
accuracy <span style="color:#f92672">=</span> accuracy_score(y_train, prediction_tree_train)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Valor Acuracia: &#39;</span>,accuracy)
</code></pre></div><h4 id="valor-acuracia--0881619937694704">Valor Acuracia:  0.881619937694704</h4>
<h2 id="---------decision-tree-test---------">&mdash;&mdash;&ndash; Decision Tree Test &mdash;&mdash;&ndash;</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">tree_view_test <span style="color:#f92672">=</span> DecisionTreeClassifier(criterion<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;gini&#39;</span>,random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)

prediction_tree_test <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>predict(X_test)
accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, prediction_tree_test)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Valor Acuracia: &#39;</span>,accuracy)
</code></pre></div><h4 id="valor-acuracia--08297101449275363">Valor Acuracia:  0.8297101449275363</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">nome_features <span style="color:#f92672">=</span> X_test<span style="color:#f92672">.</span>columns

plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">24</span>,<span style="color:#ae81ff">11</span>))

plt<span style="color:#f92672">.</span>title(<span style="color:#e6db74">&#39;teste&#39;</span>)
tree<span style="color:#f92672">.</span>plot_tree(model, label<span style="color:#f92672">=</span>None, node_ids<span style="color:#f92672">=</span>True, rounded<span style="color:#f92672">=</span>True, fontsize<span style="color:#f92672">=</span><span style="color:#ae81ff">9</span>, feature_names<span style="color:#f92672">=</span>nome_features, filled<span style="color:#f92672">=</span>True, class_names<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#39;0&#39;</span>,<span style="color:#e6db74">&#39;1&#39;</span>], proportion<span style="color:#f92672">=</span>True)
<span style="color:#75715e"># plt.savefig(&#39;decision_tree.png&#39;, format=&#39;png&#39;)</span>
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img13.png" alt="img13"></p>
<h2 id="---------randon-forest-train---------">&mdash;&mdash;&ndash; Randon Forest Train &mdash;&mdash;&ndash;</h2>
<p>O algoritmo Random Forest √© um tipo de ensemble learning, m√©todo que gera muitos classificadores e combina o seu resultado.</p>
<p>No caso do Random Forest, ele gera v√°rios decision trees, cada um com suas particularidades e combinada o resultado da classifica√ß√£o de todos eles. Essa combina√ß√£o de modelos, torna ele um algoritmo muito mais poderoso do que o Decision Tree</p>
<p><img src="/images/insuficiencia_cardiaca/img14.png" alt="img14"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">SEED<span style="color:#f92672">=</span><span style="color:#ae81ff">42</span>
randon_forest <span style="color:#f92672">=</span> RandomForestClassifier(max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>, random_state <span style="color:#f92672">=</span> SEED)

model_rando_forest <span style="color:#f92672">=</span> randon_forest<span style="color:#f92672">.</span>fit(X_train, y_train)
prediction_rf_train <span style="color:#f92672">=</span> model_rando_forest<span style="color:#f92672">.</span>predict(X_train)

accuracy <span style="color:#f92672">=</span> accuracy_score(y_train, prediction_rf_train)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Valor Acuracia: &#39;</span>,accuracy)
</code></pre></div><h4 id="valor-acuracia--09003115264797508">Valor Acuracia:  0.9003115264797508</h4>
<h2 id="---------randon-rorest-test---------">&mdash;&mdash;&ndash; Randon Rorest Test &mdash;&mdash;&ndash;</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">prediction_rf <span style="color:#f92672">=</span> model_rando_forest<span style="color:#f92672">.</span>predict(X_test)

accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, prediction_rf)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Valor Acuracia: &#39;</span>,accuracy)
</code></pre></div><h4 id="valor-acuracia--08623188405797102">Valor Acuracia:  0.8623188405797102</h4>
<h2 id="---------logistic-regression-train---------">&mdash;&mdash;&ndash; Logistic Regression Train &mdash;&mdash;&ndash;</h2>
<p>Regress√£o log√≠stica pode ser definido como uma t√©cnica estat√≠stica que busca produzir (usando um conjunto de observa√ß√µes) um modelo que possibilita predizer os valores tomados por uma vari√°vel categ√≥rica.</p>
<p>Como no algoritmos da Regress√£o Logistica as vari√°veis s√£o independentes, s√£o analisados os resultados bin√°rios e sendo direcionada a uma das duas categorias. As vari√°veis independentes podem ser categ√≥ricas ou num√©ricas, mas a vari√°vel dependente √© sempre categ√≥rica. Escrito assim:</p>
<p>P(Y=1|X) ou P(Y=0|X)</p>
<p>Isso pode ser usado para calcular a probabilidade de uma palavra ter uma conota√ß√£o positiva ou negativa (0, 1 ou em uma escala intermedi√°ria). Ou pode ser usado para determinar o objeto contido em uma foto (√°rvore, flor, grama, etc.), com cada objeto dado uma probabilidade entre 0 e 1.</p>
<p><img src="/images/insuficiencia_cardiaca/img15.png" alt="img15"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">logistic_regression <span style="color:#f92672">=</span> LogisticRegression(max_iter <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span> ,random_state <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>)
model_logistic_regression <span style="color:#f92672">=</span> logistic_regression<span style="color:#f92672">.</span>fit(X_train, y_train)
prediction_lr_train <span style="color:#f92672">=</span> model_logistic_regression<span style="color:#f92672">.</span>predict(X_train)

y_accuracy <span style="color:#f92672">=</span> accuracy_score(y_train, prediction_lr_train)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Acur√°cia:&#34;</span>, y_accuracy)
</code></pre></div><h4 id="acur√°cia-08411214953271028">Acur√°cia: 0.8411214953271028</h4>
<h2 id="---------logistic-regression-test---------">&mdash;&mdash;&ndash; Logistic Regression Test &mdash;&mdash;&ndash;</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">prediction_lr_test <span style="color:#f92672">=</span> model_logistic_regression<span style="color:#f92672">.</span>predict(X_test)
y_accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, prediction_lr_test)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Acur√°cia:&#34;</span>, y_accuracy)
</code></pre></div><h4 id="acur√°cia-08405797101449275">Acur√°cia: 0.8405797101449275</h4>
<h2 id="---------gaussiannb-train---------">&mdash;&mdash;&ndash; GaussianNB Train &mdash;&mdash;&ndash;</h2>
<p>O Teorema de Bayes √© usada para o c√°lculo da probabilidade de um evento dado que outro evento j√° ocorreu, o que √© chamado de probabilidade condicional.</p>
<p>A grande quest√£o do Teorema de Bayes √© que eu preciso ter alguma informa√ß√£o anterior, ou seja, preciso saber que um determinado evento j√° ocorreu e qual a probabilidade desse evento.</p>
<h4 id="calculo-do-algoritmo">Calculo do algoritmo</h4>
<p><img src="/images/insuficiencia_cardiaca/img16.png" alt="img16"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">gnb <span style="color:#f92672">=</span> GaussianNB()
modelo_gaucianNB <span style="color:#f92672">=</span> gnb<span style="color:#f92672">.</span>fit(X_train, y_train)

preds_naivebaies_train <span style="color:#f92672">=</span> modelo_gaucianNB<span style="color:#f92672">.</span>predict(X_train)

y_accuracy <span style="color:#f92672">=</span> accuracy_score(y_train, preds_naivebaies_train)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Acur√°cia:&#34;</span>, y_accuracy)
</code></pre></div><h4 id="acur√°cia-08426791277258567">Acur√°cia: 0.8426791277258567</h4>
<h2 id="---------gaussiannb-train----------1">&mdash;&mdash;&ndash; GaussianNB Train &mdash;&mdash;&ndash;</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">reds_naivebaies_teste <span style="color:#f92672">=</span> modelo_gaucianNB<span style="color:#f92672">.</span>predict(X_test)
y_accuracy <span style="color:#f92672">=</span> accuracy_score(y_test, reds_naivebaies_teste)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Acur√°cia:&#34;</span>, y_accuracy)
</code></pre></div><h4 id="acur√°cia-08333333333333334">Acur√°cia: 0.8333333333333334</h4>
<p>Cria√ß√£o de objeto de classificadores</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">classifiers <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;Arvore&#39;</span>: DecisionTreeClassifier(random_state<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>, max_depth<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>),
               <span style="color:#e6db74">&#39;Random Forest&#39;</span>: RandomForestClassifier(max_depth<span style="color:#f92672">=</span> <span style="color:#ae81ff">5</span>, random_state <span style="color:#f92672">=</span> SEED),
               <span style="color:#e6db74">&#39;Naive Bayes&#39;</span>: GaussianNB(),
               <span style="color:#e6db74">&#39;Regress√£o Logistica&#39;</span>: LogisticRegression(max_iter <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span> ,random_state <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>),
              }

<span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> X_train<span style="color:#f92672">.</span>columns:
    <span style="color:#66d9ef">if</span> X_train[c]<span style="color:#f92672">.</span>dtype <span style="color:#f92672">==</span> <span style="color:#e6db74">&#34;object&#34;</span>:
        X_train[c] <span style="color:#f92672">=</span> X_train[c]<span style="color:#f92672">.</span>astype(<span style="color:#e6db74">&#39;category&#39;</span>)
        X_train[c] <span style="color:#f92672">=</span> X_train[c]<span style="color:#f92672">.</span>cat<span style="color:#f92672">.</span>codes  

<span style="color:#66d9ef">for</span> clf <span style="color:#f92672">in</span> classifiers<span style="color:#f92672">.</span>items():
    clf[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>fit(X_train, y_train)
    preds <span style="color:#f92672">=</span> clf[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>predict(X_test)
    score <span style="color:#f92672">=</span> accuracy_score(preds, y_test)
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">------{clf[0]}------&#39;</span>)
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Acur√°cia:&#34;</span>,accuracy_score(y_test, preds))
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Precis√£o:&#34;</span>,precision_score(y_test, preds))
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;Recall:&#34;</span>,recall_score(y_test, preds))
    <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#34;F1:&#34;</span>,f1_score(y_test, preds))
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img17.png" alt="img17"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">preds <span style="color:#f92672">=</span> []
clf_trained <span style="color:#f92672">=</span> []
names<span style="color:#f92672">=</span>[]
<span style="color:#66d9ef">for</span> clf <span style="color:#f92672">in</span> classifiers<span style="color:#f92672">.</span>items():
    clf_atual <span style="color:#f92672">=</span> clf[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>fit(X_train, y_train)
    clf_trained<span style="color:#f92672">.</span>append(clf_atual)

    pred_atual<span style="color:#f92672">=</span>clf[<span style="color:#ae81ff">1</span>]<span style="color:#f92672">.</span>predict(X_test)
    preds<span style="color:#f92672">.</span>append(pred_atual)
    names<span style="color:#f92672">.</span>append(clf[<span style="color:#ae81ff">0</span>])
    
    <span style="color:#66d9ef">print</span>(precision_recall_fscore_support(y_test, pred_atual, average<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;macro&#39;</span>))
</code></pre></div><p>(0.8289915966386554, 0.832855093256815, 0.8290616311094128, None)
(0.8611037056784858, 0.8598756575801052, 0.8604428358526719, None)
(0.8346729708431836, 0.8385142674956161, 0.8330176767676768, None)
(0.8409914404243028, 0.8450502152080345, 0.8401684653856278, None)</p>
<h3 id="matriz-confus√£o">Matriz Confus√£o</h3>
<p><img src="/images/insuficiencia_cardiaca/img18.png" alt="img18"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">fig, axs <span style="color:#f92672">=</span>  plt<span style="color:#f92672">.</span>subplots(<span style="color:#ae81ff">2</span>, <span style="color:#ae81ff">2</span>, figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">15</span>, <span style="color:#ae81ff">10</span>))
position <span style="color:#f92672">=</span> [axs[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">0</span>],axs[<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>],axs[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">0</span>],axs[<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">1</span>]]

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(classifiers)):
    cm <span style="color:#f92672">=</span> confusion_matrix(y_test, preds[i], labels<span style="color:#f92672">=</span>clf_trained[i]<span style="color:#f92672">.</span>classes_)
    disp <span style="color:#f92672">=</span> ConfusionMatrixDisplay(confusion_matrix<span style="color:#f92672">=</span>cm, display_labels<span style="color:#f92672">=</span>[<span style="color:#e6db74">&#34;Ter√°&#34;</span>, <span style="color:#e6db74">&#34;N√£o ter√°&#34;</span>])
    position[i]<span style="color:#f92672">.</span>set_title(names[i])
    disp<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>position[i])
    
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img19.png" alt="img19"></p>
<h2 id="cross-validation">Cross-Validation</h2>
<p>A escolha da valida√ß√£o cruzada correta depende do conjunto de dados com o qual voc√™ est√° lidando, e a escolha da valida√ß√£o cruzada em um conjunto de dados pode ou n√£o se aplicar a outros conjuntos de dados. No entanto, existem alguns tipos de t√©cnicas de valida√ß√£o cruzada que s√£o as mais populares e amplamente utilizadas. Esses incluem:</p>
<ul>
<li>valida√ß√£o cruzada k-fold.</li>
<li>valida√ß√£o cruzada estratificada em k-fold A valida√ß√£o cruzada √© dividir os dados de treinamento em algumas partes. Treinamos o modelo em algumas dessas pe√ßas e testamos nas demais.</li>
</ul>
<p><img src="/images/insuficiencia_cardiaca/img20.png" alt="img20"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> classifiers<span style="color:#f92672">.</span>items():
    scores_dt <span style="color:#f92672">=</span> cross_val_score(i[<span style="color:#ae81ff">1</span>], X_test, y_test, scoring<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;accuracy&#39;</span>, cv<span style="color:#f92672">=</span><span style="color:#ae81ff">5</span>)
    <span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#39;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">---- {i[0]} ----&#39;</span>)
    <span style="color:#66d9ef">print</span>(scores_dt)
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img21.png" alt="img21"></p>
<h2 id="curva-roc">Curva ROC</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">ax <span style="color:#f92672">=</span> plt<span style="color:#f92672">.</span>gca()
<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(len(classifiers)):
    clf <span style="color:#f92672">=</span> classifiers[names[i]]      
    rfc_disp <span style="color:#f92672">=</span> RocCurveDisplay<span style="color:#f92672">.</span>from_estimator(clf, X_test, y_test, ax<span style="color:#f92672">=</span>ax, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.7</span>)
plt<span style="color:#f92672">.</span>show()
    
clf2 <span style="color:#f92672">=</span> classifiers[<span style="color:#e6db74">&#39;Random Forest&#39;</span>]
svc_disp <span style="color:#f92672">=</span> RocCurveDisplay<span style="color:#f92672">.</span>from_estimator(clf2, X_test, y_test)
svc_disp<span style="color:#f92672">.</span>plot(ax<span style="color:#f92672">=</span>ax, alpha<span style="color:#f92672">=</span><span style="color:#ae81ff">0.8</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><p><img src="/images/insuficiencia_cardiaca/img22.png" alt="img22"></p>
<h2 id="insigths">Insigths</h2>
<p>Ap√≥s toda a an√°lise do problema e entendimento de algumas hip√≥teses vistas na etapa de Visualiza√ß√£o, criamos o conjunto de treino e testes e aplicamos em diferentes algoritmos. Iniciamos o treinamento dos algoritmos com a tradicional Decision Tree, partindo para Random Forest, GussianNB e Logistic Regression. Para a precis√£o dos resultados dos treinamentos, aplicamos uma camada de Cross-Validation onde os modelos passaram por diferentes conjuntos de dados, resultando em score variados para validarmos a qualidade dos modelos.</p>
<p>Ap√≥s essa valida√ß√£o, identificamos que o modelo Random Forest se destacou com uma Acur√°cia media de 0.88 e uma deriva√ß√£o de 0.05, sendo o melhor resultado da acur√°cia de todos os algoritmos.</p>
<p>Como estamos predizendo um problema de sa√∫de, devemos ter o seguinte pensamento: caso o paciente v√° a um m√©dico √© melhor que ele seja diagnosticado com uma doen√ßa card√≠aca e previna, porem ele N√ÉO tem nenhum problema. Do que ele seja diagnosticado que n√£o tem uma doen√ßa card√≠aca, e, na verdade, ele TEM problema card√≠aco.</p>
<p>Logo, compreendemos que em nossos algoritmos devem conter um BAIXO √≠ndice de falsos negativos(FN). Analisando a matriz confus√£o, nota-se que dentre os quatro algoritmos, apenas um se destaca por conter poucos falsos negativos(FN), a Random Forest. Nota-se que enquanto os outros modelos chegam a 30 ou 32 FN, a Random Forest chega diminuir quase pela metade, chegando aos 18 FN.</p>
<p>Para compararmos as probabilidades de acerto desses Falsos Negativos, devemos olhar para o maior Score de Recall, e novamente a Random Fores se destaca com seus 0.88 de assertividade.</p>
<p>Com isso, entendemos que para predizermos a insufici√™ncia card√≠aca de um paciente, podemos utilizar nosso modelo treinado com Random Forest visto que comparamos os resultados de suas predi√ß√µes, e tamb√©m testamos a qualidade do modelo comprovando a sua efic√°cia em seus resultados.</p>
<p>Espero que tenha aproveitado todo o desenvolvimento do projeto, e que sua leitura tenha agregado conhecimentos.</p>
]]></content>
        </item>
        
        <item>
            <title>Microservice Project ‚Äì Step 3</title>
            <link>https://patrickpiccini.github.io/posts/microservice_project_step03/</link>
            <pubDate>Thu, 16 Jun 2022 10:01:53 -0300</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/microservice_project_step03/</guid>
            <description>Table of Contents  Cria√ß√£o do Docker-Compose-Services Teste na OCI Resumo   Nesse pr√≥ximo passo, parto do pressuposto que meu ambiente j√° est√° configurado e com todas as instala√ß√µes feitas, assim, posso come√ßar a criar as primeiras linhas de c√≥digo.
Devemos come√ßar criando uma pasta chamada MS-Application. Essa pasta ser√° onde iremos criar todos os microsservi√ßos, configura√ß√£o de containers de servi√ßo, e mais alguns detalhes, que ser√£o mostrados no decorrer das publica√ß√µes.</description>
            <content type="html"><![CDATA[<p><img src="/images/microservice_project/microservices.png" alt="microservices"></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#cria%C3%A7%C3%A3o-do-docker-compose-services">Cria√ß√£o do Docker-Compose-Services</a></li>
<li><a href="#teste-na-oci">Teste na OCI</a></li>
<li><a href="#resumo">Resumo</a></li>
</ul>
<hr>
<p>Nesse pr√≥ximo passo, parto do pressuposto que meu ambiente j√° est√° configurado e com todas as instala√ß√µes feitas, assim, posso come√ßar a criar as primeiras linhas de c√≥digo.</p>
<p>Devemos come√ßar criando uma pasta chamada <em>MS-Application.</em> Essa pasta ser√° onde iremos criar todos os microsservi√ßos, configura√ß√£o de containers de servi√ßo, e mais alguns detalhes, que ser√£o mostrados no decorrer das publica√ß√µes.</p>
<p>Na raiz da pasta, criamos um arquivo chamado <em>docker-compose-services.yml.</em></p>
<pre><code class="language-Estrutura" data-lang="Estrutura">MS-Application
‚îÇ   docker-compose-services.yml
</code></pre><h2 id="cria√ß√£o-do-docker-compose-services">Cria√ß√£o do Docker-Compose-Services</h2>
<p>Como vamos usar containers para praticamente tudo, ser√° necess√°rio que os servidores Rabbit, Redis, Postgres, e interfaces de manager sejam criadas separadamente em seus devidos containers. √â necess√°ria essa separa√ß√£o para que nenhum servidor dependa do outro para funcionar. Com isso, j√° temos os primeiros passos na cria√ß√£o da arquitetura de microsservi√ßos.</p>
<p>Para inicializar esses servi√ßos rapidamente, iremos desenvolver um Docker-Compose e configuraremos uma <em>Network</em>, onde posteriormente estar√£o todos os servi√ßos dentro dessa mesma rede.</p>
<p>A rede foi nomeada de <em>internal-network,</em> nela, iremos configurar o endere√ßo 10.5.0.0 sendo uma rede classe A, com uma m√°scara de rede /16. Tamb√©m iremos definir o gateway da rede para 10.5.0.1.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker">version: <span style="color:#e6db74">&#34;3.7&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>networks:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  network-service:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    driver: bridge<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    name: internal-network<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ipam:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      config:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        - subnet: 10.5.0.0/16<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>          gateway: 10.5.0.1<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Nos servi√ßos, iniciamos configurando o RabbitMQ. Utilizaremos a imagem <em>rabbitmq:3-management-alpine,</em> que √© uma imagem m√≠nima do Docker baseada no Alpine Linux com um √≠ndice de pacotes completo e apenas 5 MB de tamanho. Nas vari√°veis de ambiente √© deixado com o valor padr√£o o user, password e host, que ser√° utilizado posteriormente para conectar ao manager do rabbit. Nas portas, devemos colocar 15672 para o manager e 5672 para o servidor. E por fim, iremos configurar o cont√™iner para ficar dentro da Network que foi criada anteriormente, apontando tamb√©m um ip est√°tico para essa instancia.</p>
<p><a href="https://hub.docker.com/_/alpine">Alpine</a></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker">services:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>  rabbitmq:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    image: <span style="color:#e6db74">&#34;rabbitmq:3-management-alpine&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    environment:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      RABBITMQ_DEFAULT_USER: <span style="color:#e6db74">&#34;guest&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      RABBITMQ_DEFAULT_PASS: <span style="color:#e6db74">&#34;guest&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      RABBITMQ_DEFAULT_VHOST: <span style="color:#e6db74">&#34;/&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - <span style="color:#e6db74">&#34;15672:15672&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - <span style="color:#e6db74">&#34;5672:5672&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    labels:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      NAME: <span style="color:#e6db74">&#34;rabbitmq1&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    networks:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      network-service:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        ipv4_address: 10.5.0.10<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>A estrutura dos pr√≥ximos servi√ßos √© bem semelhante a essa primeira, com apenas alguns detalhes como diferen√ßa. No Postgres, utilizaremos a imagem <em>postgres:13</em>, iremos indicar as vari√°veis padr√µes do user e password para conex√£o a inst√¢ncia, apontaremos a porta padr√£o 5432, criaremos um volume compartilhado de <em>.data</em> para <em>/data/,</em> configuraremosaNetwork com o ip est√°tico, e um detalhe muito importante, ser√° colocado o par√¢metro <em>restart: Always</em> que far√° com que a inst√¢ncia seja reiniciada caso pare de funcionar. Se for interrompido manualmente, ele ser√° reiniciado somente quando o daemon do Docker for reiniciado ou o pr√≥prio cont√™iner for reiniciado manualmente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker">  postgres:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    container_name: postgres_container<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    image: postgres:13<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    restart: always<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    environment:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      POSTGRES_USER: postgres<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      POSTGRES_PASSWORD: postgres<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      POSTGRES_DB: baseapplication<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - <span style="color:#e6db74">&#34;5432:5432&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - ./data:/data/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    networks:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      network-service:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        ipv4_address: 10.5.0.11<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>Para ter uma parte visual do banco de dados, faremos a cria√ß√£o de uma inst√¢ncia com o PgAdmin, que poderemos conectar ao servidor do postgres via Web. Sendo assim, iremos utilizar a imagem <em>dpage/pgadmin4,</em> com as vari√°veis de e-mail e password para entrarmos na p√°gina web. Iremos apontar a porta de 16543/80 (external/internal), compartilharemos os volumes./data/:/data/ e ./postgres-backup:/var/lib/postgresql/backups, iremos configurar a network com um ip est√°tico, e colaremos uma depend√™ncia no par√¢metro <em>depends_on ‚Äì postgres.</em> Isso far√° com o a inst√¢ncia do PgAdmin s√≥ seja criada, ap√≥s a cria√ß√£o da inst√¢ncia do postgres.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker">  pgadmin:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    container_name: pgadmin_container<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    image: dpage/pgadmin4<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    environment:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      PGADMIN_DEFAULT_EMAIL: admin@admin.com<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      PGADMIN_DEFAULT_PASSWORD: admin<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - <span style="color:#e6db74">&#34;16543:80&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    depends_on:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - postgres<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    volumes:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - ./data/:/data/<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - ./postgres-backup:/var/lib/postgresql/backups<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    networks:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      network-service:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        ipv4_address: 10.5.0.12<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>E para camada de cache, iremos criar uma inst√¢ncia com Redis utilizando a imagem <em>redis:alpine</em>, apontando a porta padr√£o 6379, e configurando a Network com um ip est√°tico.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-docker" data-lang="docker">  redis:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    image: redis:alpine<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    container_name: redis-container<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    ports:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      - <span style="color:#e6db74">&#34;6379:6379&#34;</span><span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>    networks:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>      network-service:<span style="color:#960050;background-color:#1e0010">
</span><span style="color:#960050;background-color:#1e0010"></span>        ipv4_address: 10.5.0.9<span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>No final, teremos v√°rios containers rodando dentro de uma Rede, tendo algo parecido com a seguinte imagem:</p>
<p><img src="/images/microservice_project/img16.jpg" alt="img16"></p>
<h2 id="teste-na-oci">Teste na OCI</h2>
<p>Agora que temos pronto o Docker-Compose com todos os servi√ßos que utilizaremos, devemos fazer um teste dentro da VM que criamos na OCI. Para conseguir compartilhar o c√≥digo, fa√ßo <em>um git commit</em> de minha pasta MS-Application, e dentro da inst√¢ncia OCI dou um <em>git pull</em> para baixar.</p>
<p>OBS: N√£o entrarei em detalhes nos comandos do git, caso tenha alguma d√∫vida especifica, consulte a documenta√ß√£o oficial: <a href="https://comandosgit.github.io/"><strong>https://comandosgit.github.io/</strong></a></p>
<p>Dentro a inst√¢ncia, inicio meus servi√ßos com o comando <em>docker-compose -f docker-compose-services.yml up,</em> e passo o nome do arquivo que dever√° ser iniciado.</p>
<p>Nesse momento come√ßar√° a baixar as imagens dos cont√™ineres.</p>
<p><img src="/images/microservice_project/img17.jpg" alt="img17"></p>
<p><img src="/images/microservice_project/img18.jpg" alt="img18"></p>
<p><img src="/images/microservice_project/img19.jpg" alt="img19"></p>
<p>Agora que est√° tudo rodando, pude fazer um teste me conectando ao manager do RabbitMQ pela Web. Por√©m como a aplica√ß√£o est√° em cloud, √© necess√°rio que nas configura√ß√µes da VNC do projeto, sejam expostas as portas que iremos utilizar para nos conectar externamente.</p>
<p><img src="/images/microservice_project/img20.jpg" alt="img20"></p>
<p>Na OCI, em Networking &gt; Virtual Cloud Networks &gt; sua_vnc &gt; Security List Details &gt; Ingress Rules. iremos adicionar as portas que utilizaremo</p>
<p><img src="/images/microservice_project/img21.jpg" alt="img21"></p>
<p><img src="/images/microservice_project/img22.jpg" alt="img22"></p>
<p>Ap√≥s a libera√ß√£o da porta, consegui ter acesso aos meus cont√™ineres, tanto o do rabbit quando ao pgadmin, que tamb√©m liberei a porta. Percebam que para me conectar aos meus cont√™ineres, utilizo o ip public da VM que estou utilizando.</p>
<p><img src="/images/microservice_project/img23.jpg" alt="img23"></p>
<p><img src="/images/microservice_project/img24.jpg" alt="img24"></p>
<h2 id="resumo">Resumo</h2>
<p>Nesse Step, criamos o arquivo <em>docker-compose-services.yml</em> que √© respons√°vel por iniciar os servidores RabbitMQ, Postgres e Redis, juntamente as interfaces PgAdmin e RabbitManager. Foram liberadas as portas dos servidores para visualiza√ß√£o externa, e tamb√©m foi feito um teste acessando as interfaces externamente √† OCI, tendo sucesso na conex√£o.</p>
]]></content>
        </item>
        
        <item>
            <title>Microservice Project ‚Äì Step 2</title>
            <link>https://patrickpiccini.github.io/posts/microservice_project_step02/</link>
            <pubDate>Thu, 09 Jun 2022 10:01:52 -0300</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/microservice_project_step02/</guid>
            <description>Table of Contents  Entrar na Instancia via shell Instalar Docker Instalar Docker-Compose Instalar Git Resumo   Ap√≥s Configurar a infraestrutura no Oracle Cloud, necessitamos fazer instala√ß√µes de alguns programas que iremos utilizar. O Docker para a cria√ß√£o dos nossos containers de servidores e microsservi√ßos, o Docker-Compose para facilitar a cria√ß√£o dos containers, e o Git, para versionamento de c√≥digo.
Como desenvolvi os c√≥digos fora de nossa VM da OCI, o Git √© o fator principal para que todos os c√≥digos sejam dispon√≠veis facilmente.</description>
            <content type="html"><![CDATA[<p><img src="/images/microservice_project/microservices.png" alt="microservices"></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#entrar-na-instancia-via-shell">Entrar na Instancia via shell</a></li>
<li><a href="#instalar-docker">Instalar Docker</a></li>
<li><a href="#instalar-docker-compose">Instalar Docker-Compose</a></li>
<li><a href="#instalar-git">Instalar Git</a></li>
<li><a href="#resumo">Resumo</a></li>
</ul>
<hr>
<p>Ap√≥s Configurar a infraestrutura no Oracle Cloud, necessitamos fazer instala√ß√µes de alguns programas que iremos utilizar. O Docker para a cria√ß√£o dos nossos containers de servidores e microsservi√ßos, o Docker-Compose para facilitar a cria√ß√£o dos containers, e o Git, para versionamento de c√≥digo.</p>
<p>Como desenvolvi os c√≥digos fora de nossa VM da OCI, o Git √© o fator principal para que todos os c√≥digos sejam dispon√≠veis facilmente.</p>
<h2 id="entrar-na-instancia-via-shell">Entrar na Instancia via shell</h2>
<p>Logado no usu√°rio <strong>devel_user</strong> , iniciei o cloud shell para conectar-se ao VM criada atrav√©s do SSH Connection.</p>
<p>* Detalhe, essa conex√£o pode ser feita de qualquer terminal ou computador que tenha acesso ao SSH Connection, desde que se tenha cadastrado na hora da cria√ß√£o da VM a SSH-KEY da m√°quina que onde se conectar√°.</p>
<p>Com o comando <strong>ssh opc@&lt;ip_public&gt;</strong> entrei na m√°quina e comecei a fazer a instala√ß√£o com o pacote de instala√ß√£o Dandified YUM (DNF) no Oracle Linux 8.</p>
<h2 id="instalar-docker">Instalar Docker</h2>
<p>Com a sequ√™ncia de comando abaixo, foi instalado o Docker na VM:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">dnf install -y dnf-utils zip unzip
dnf config-manager --add-repo<span style="color:#f92672">=</span>https://download.docker.com/linux/centos/docker-ce.repo
dnf remove -y runc
dnf install -y docker-ce --nobest
systemctl enable docker.service
systemctl start docker.service
systemctl status docker.service
docker version
</code></pre></div><p>Adicionar o usu√°rio ao grupo docker para poder executar comandos Docker;</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo usermod -aG docker opc
newgrp docker  
</code></pre></div><p>Vemos que Docker est√° rodando e pronto para ser usando.</p>
<p><img src="/images/microservice_project/img14.jpg" alt="img14"></p>
<h2 id="instalar-docker-compose">Instalar Docker-Compose</h2>
<p>Foi instalado o Docker-Compose na VM com os seguintes comandos:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">sudo dnf -y install curl
curl -s https://api.github.com/repos/docker/compose/releases/latest|grep browser_download_url|grep docker-compose-linux-x86_64|cut -d <span style="color:#e6db74">&#39;&#34;&#39;</span> -f 4|wget -qi ‚Äì
ls -1 docker-compose-linux-x86_64*
sha256sum -c docker-compose-linux-x86_64.sha256
chmod +x docker-compose-linux-x86_64
sudo mv docker-compose-linux-x86_64 /usr/local/bin/docker-compose
docker-compose version
</code></pre></div><p>Docker-Compose instalado com sucesso.</p>
<p><img src="/images/microservice_project/img15.jpg" alt="img15"></p>
<h2 id="instalar-git">Instalar Git</h2>
<p>Comandos para instala√ß√£o do Git:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-shell" data-lang="shell">yum install curl-devel expat-devel gettext-devel openssl-devel zlib-devel -y
yum install gcc perl-ExtUtils-MakeMaker -y
cd /usr/local/
wget https://mirrors.edge.kernel.org/pub/software/scm/git/git-2.35.1.tar.gz
tar zxvf git-2.35.1.tar.gz
cd git-2.35.1/
make prefix<span style="color:#f92672">=</span>/usr/local/git all
make prefix<span style="color:#f92672">=</span>/usr/local/git install
echo <span style="color:#e6db74">&#34;export PATH=</span>$PATH<span style="color:#e6db74">:/usr/local/git/bin&#34;</span> &gt;&gt; /etc/bashrc
source /etc/bashrc
</code></pre></div><h2 id="resumo">Resumo</h2>
<p>Nesse Step, nos conectamos a inst√¢ncia da OCI e instalamos algumas depend√™ncias para o nosso ambiente de produ√ß√£o. Instalamos o Docker, Docker-Compose e Git.</p>
]]></content>
        </item>
        
        <item>
            <title>Microservice Project ‚Äì Step 1</title>
            <link>https://patrickpiccini.github.io/posts/microservice_project_step01/</link>
            <pubDate>Thu, 02 Jun 2022 13:00:52 -0200</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/microservice_project_step01/</guid>
            <description>Table of Contents  Cria√ß√£o do Compartment Cria√ß√£o de Usu√°rio Cria√ß√£o de Grupo Cria√ß√£o de Policies Cria√ß√£o de SSH-KEY Cria√ß√£o de Instancia VM Resumo   Nesse primeiro passo, iremos configurar um ambiente OCI para rodar toda a aplica√ß√£o em cloud.
Cria√ß√£o do Compartment Iremos criar um conpartiment.
No √≠cone de hamburguer na p√°gina inicial do OCI, iremos em &amp;gt; Identity &amp;gt; Security &amp;gt; compartments, e criaremos um compartimento com o nome Developmet.</description>
            <content type="html"><![CDATA[<p><img src="/images/microservice_project/microservices.png" alt="microservices"></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#cria%C3%A7%C3%A3o-do-compartment">Cria√ß√£o do Compartment</a></li>
<li><a href="#cria%C3%A7%C3%A3o-de-usu%C3%A1rio">Cria√ß√£o de Usu√°rio</a></li>
<li><a href="#cria%C3%A7%C3%A3o-de-grupo">Cria√ß√£o de Grupo</a></li>
<li><a href="#cria%C3%A7%C3%A3o-de-policies">Cria√ß√£o de Policies</a></li>
<li><a href="#cria%C3%A7%C3%A3o-de-ssh-key">Cria√ß√£o de SSH-KEY</a></li>
<li><a href="#cria%C3%A7%C3%A3o-de-instancia-vm">Cria√ß√£o de Instancia VM</a></li>
<li><a href="#resumo">Resumo</a></li>
</ul>
<hr>
<p>Nesse primeiro passo, iremos configurar um ambiente OCI para rodar toda a aplica√ß√£o em cloud.</p>
<h2 id="cria√ß√£o-do-compartment">Cria√ß√£o do Compartment</h2>
<p>Iremos criar um <em>conpartiment.</em></p>
<p>No √≠cone de hamburguer na p√°gina inicial do OCI, iremos em &gt; Identity &gt; Security &gt; compartments, e criaremos um compartimento com o nome <strong>Developmet</strong>.</p>
<p><img src="/images/microservice_project/img3.jpg" alt="img3"></p>
<h2 id="cria√ß√£o-de-usu√°rio">Cria√ß√£o de Usu√°rio</h2>
<p>Ap√≥s isso, criaremos um usu√°rio de desenvolvimento para ter acesso somente ao compartimento <strong>Developmet</strong>.</p>
<p>Novamente no menu lateral, em &gt; Identity &gt; Security &gt; users, iremos criar o usu√°rio <strong>devel_user,</strong> com o tipo IAM USER. Esses usu√°rios podem acessar os servi√ßos do Oracle Cloud Infrastructure, mas nem todos os servi√ßos do Cloud Platform. Os usu√°rios do IAM s√£o cen√°rios de usu√°rio at√≠pico, como acesso de administrador de emerg√™ncia.</p>
<p><img src="/images/microservice_project/img4.jpg" alt="img4"></p>
<p><img src="/images/microservice_project/img5.jpg" alt="img5"></p>
<h2 id="cria√ß√£o-de-grupo">Cria√ß√£o de Grupo</h2>
<p>No menu lateral, em &gt; Identity &gt; Security &gt; groups, criaremos um grupo com o nome de <strong>Developer_Group.</strong> Depois disso, iremos adicionar o usu√°rio <strong>devel_user</strong> ao grupo clicando no bot√£o &ldquo;Add user to Group&rdquo;.</p>
<p><img src="/images/microservice_project/img6.jpg" alt="img6"></p>
<h2 id="cria√ß√£o-de-policies">Cria√ß√£o de Policies</h2>
<p>Finalizando o processo de cria√ß√£o de usu√°rio, grupo, e adi√ß√£o do usu√°rio ao grupo, √© necess√°rio atribuir uma sequ√™ncia de pol√≠ticas de permiss√µes ao grupo, para que assim, o grupo criado tenha acesso ao compartimento <em>Developer</em> para fazer as devidas intera√ß√µes.</p>
<p>Vamos em &gt; Identity &gt; Security &gt; Policies</p>
<p><img src="/images/microservice_project/img7.jpg" alt="img7"></p>
<p>Ap√≥s ser direcionado a p√°gina de policies, selecionamos o compartimento <strong>Developmet</strong> para receber a pol√≠tica que criamos. Na policie, iremos permitir o Developer_Group (e todos seus usu√°rios) a utiliza√ß√£o de todos os recursos no compartimento OCI.</p>
<p><img src="/images/microservice_project/img8.jpg" alt="img8"></p>
<p>Tamb√©m ser√° criado uma outra policie no compartimento <strong>root</strong> , para liberar o acesso ao terminal cloud shell, atrav√©s dos usu√°rios do grupo <em>Developmet.</em> Isso dever√° ser feito devido ao fato de que precisaremos de uma ssh-key disponibilizada pelo usu√°rio para conseguir criar nossa instancia no OCI.</p>
<p><img src="/images/microservice_project/img9.jpg" alt="img9"></p>
<h2 id="cria√ß√£o-de-ssh-key">Cria√ß√£o de SSH-KEY</h2>
<p>Logado no usu√°rio <em>devel_user,</em> conectaremos a Oracle Cloud Shell para adquirir uma ssh_key que posteriormente iremos utilizar. Para isso, vamos usar alguns simples comandos para a cria√ß√£o dessa chave.</p>
<p><img src="/images/microservice_project/img10.jpg" alt="img10"></p>
<pre><code class="language-cli" data-lang="cli">ssh-keygen ‚Äì Para cria√ß√£o da chave

cat /home/your_user/.ssh/id_rsa.pub 
‚Äì Mostrar√° o conte√∫do contido no arquivo id_rsa.pub,
  que foi criado com o comando anterior
</code></pre><p><img src="/images/microservice_project/img11.jpg" alt="img11"></p>
<h2 id="cria√ß√£o-de-instancia-vm">Cria√ß√£o de Instancia VM</h2>
<p>Ainda conectado ao usu√°rio <em>devel_user</em> criaremos uma inst√¢ncia, que nada mais √© que uma Virtual Machine. Em &gt; compute &gt; instances &gt; create instance._
<img src="/images/microservice_project/img12.jpg" alt="img12"></p>
<p>Ao criar uma inst√¢ncia na p√°gina de configura√ß√£o da VM, devemos colar a ssh-key adquirida anteriormente no campo onde solicita essa chave. Isso √© feito para que se consiga acessar a VM remotamente. As imagens do Oracle Linux, CentOS ou Ubuntu usam esse par de chaves SSH ao contr√°rio de uma senha para autenticar um usu√°rio.</p>
<p><img src="/images/microservice_project/img13.jpg" alt="img13"></p>
<p>OBS: A configura√ß√£o da inst√¢ncia que irei utilizar, s√£o disponibilizadas pelo servi√ßo <em>Oracle Cloud ‚Äì Free Tier,</em> sendo ela 1 VM de computa√ß√£o baseadas em AMD com 1/8 OCPU** e 1 GB de mem√≥ria cada.</p>
<p>Para mais informa√ß√µes dos servi√ßos Free Tier, acesse: <a href="https://www.oracle.com/br/cloud/free/">https://www.oracle.com/br/cloud/free/</a></p>
<h2 id="resumo">Resumo</h2>
<p>Nesse Step, come√ßamos as criar o ambiente onde rodaremos nossa aplica√ß√£o. Configuramos um compartment, usu√°rio e grupo de usu√°rio, que ser√° o respons√°vel pelo acesso ao desenvolvimento na inst√¢ncia OCI. Definimos algumas pol√≠ticas de usu√°rio. Tamb√©m criamos uma ssh-key que utilizamos para a cria√ß√£o da instancia OCI.</p>
]]></content>
        </item>
        
        <item>
            <title>Um projeto completo de Microservices</title>
            <link>https://patrickpiccini.github.io/posts/microservice_project_introduction/</link>
            <pubDate>Thu, 02 Jun 2022 13:00:52 -0100</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/microservice_project_introduction/</guid>
            <description>Table of Contents  Entendimento do problema Objetivo Arquitetura do Projeto Completo   H√° um tempo eu desejava entender melhor como os t√£o famosos microsservi√ßos conseguem trabalhar individualmente, por√©m todos conectados. Foi ent√£o que decidi projetar uma pequena aplica√ß√£o onde iria me aprofundar nesses conhecimentos, e que tamb√©m me desafiaria a criar uma aplica√ß√£o completa seguindo o Software Development Life Circle. Partindo desde a cria√ß√£o da ideia, at√© o deploy.</description>
            <content type="html"><![CDATA[<p><img src="/images/microservice_project/microservices.png" alt="microservices"></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#entendimento-do-problema">Entendimento do problema</a></li>
<li><a href="#objetivo">Objetivo</a></li>
<li><a href="#arquitetura-do-projeto-completo">Arquitetura do Projeto Completo</a></li>
</ul>
<hr>
<p>H√° um tempo eu desejava entender melhor como os t√£o famosos microsservi√ßos conseguem trabalhar individualmente, por√©m todos conectados. Foi ent√£o que decidi projetar uma pequena aplica√ß√£o onde iria me aprofundar nesses conhecimentos, e que tamb√©m me desafiaria a criar uma aplica√ß√£o completa seguindo o <strong>Software Development Life Circle</strong>. Partindo desde a cria√ß√£o da ideia, at√© o deploy.</p>
<p>Isso pode ser representado conforme o seguinte fluxo:</p>
<p><img src="/images/microservice_project/img1.jpg" alt="img1"></p>
<p>Ent√£o, meu nome √© Patrick Berlatto Piccini, e esse √© meu projeto completo de microservices.</p>
<h2 id="entendimento-do-problema">Entendimento do problema</h2>
<p>Nesse projeto, utilizarei algumas ferramentas contidas na OCI (Oracle Claud Infraestructure) visto que, recentemente (Fevereiro 2022) passei na certifica√ß√£o &quot;Oracle Cloud Infrastructure Foundations 2021 Associate&quot;. Se voc√™ desejar seguir os passos da cria√ß√£o da aplica√ß√£o e desenvolver junto comigo o c√≥digo, √© opcional utilizar o OCI.</p>
<p>Vamos come√ßar&hellip;</p>
<h3 id="objetivo">Objetivo</h3>
<p>Criar duas aplica√ß√µes b√°sicas de microsservi√ßos:</p>
<p>O primeiro deles dever√° ser um cadastro de usu√°rios, contendo as seguintes informa√ß√µes:</p>
<ul>
<li>create_user, show_all_user, show_one_user, edit_user, edit_password e delete_user</li>
</ul>
<p>Tabela de usu√°rios &quot;users&quot; dever√° conter os campos: user_id, nick_name, full_name, password, cpf, email, phone_number, created_at, updated_at.</p>
<p>O segundo ser√° um servi√ßo de OS (ordem de servi√ßo) que dever√° conter no cadastro, o user_id do usu√°rio contido no banco de dados. Dever√° ter as seguintes informa√ß√µes:</p>
<ul>
<li>order_id, user_id, item_description, item_quantity, item_price, total_value, created_at, updated_at.</li>
</ul>
<p>A arquitetura da aplica√ß√£o ser√° a seguinte: criaremos uma API que ser√° respons√°vel por distribuir as requisi√ß√µes atrav√©s de um broker de mensagens chamado RabbitMQ, e tamb√©m criar as filas e tabelas necess√°rias para a aplica√ß√£o.</p>
<p>Nesse broker, ter√£o duas filas onde a API far√° a separa√ß√£o das mensagens e enviar√° ao seu devido destino, onde teremos dois microsservi√ßos, uma para <em>usu√°rios</em>, e outro para os <em>orders</em>. Cada microsservi√ßo √© conectado a um banco de dados Postgres onde ser√£o armazenadas as informa√ß√µes dos <em>usu√°rios</em> e dos <em>orders.</em></p>
<p>Juntamente a API, haver√° uma camada de mem√≥ria cache onde utilizaremos o Redis para fazer essa fun√ß√£o. Ent√£o, caso uma requisi√ß√£o j√° tenha sido feita, a API ir√° verificar antes nos dados em Cache se j√° existe essa informa√ß√£o. Assim, o usu√°rio ter√° o retorno muito mais r√°pido.</p>
<p><img src="/images/microservice_project/img2.jpg" alt="img2"></p>
<h2 id="arquitetura-do-projeto-completo">Arquitetura do Projeto Completo</h2>
<pre><code class="language-Estrutura" data-lang="Estrutura">MS-application
‚îÇ   .gitignore
‚îÇ   docker-compose-services.yml
‚îÇ
‚îú‚îÄ‚îÄ‚îÄAPI
‚îÇ   ‚îÇ   docker-compose-api.yml
‚îÇ   ‚îÇ   Dockerfile
‚îÇ   ‚îÇ   requirements.txt
‚îÇ   ‚îÇ   server.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄconfig
‚îÇ   ‚îÇ       database_connection.py
‚îÇ   ‚îÇ       rabbitmq_connection.py
‚îÇ   ‚îÇ       redis_connection.py
‚îÇ   ‚îÇ       __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄrabbitmq_controller
‚îÇ           rabbit_queues.py
‚îÇ           __init__.py
‚îÇ
‚îú‚îÄ‚îÄ‚îÄMS1
‚îÇ   ‚îÇ   docker-compose-microservice1.yml
‚îÇ   ‚îÇ   Dockerfile
‚îÇ   ‚îÇ   main.py
‚îÇ   ‚îÇ   requirements.txt
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄconfig
‚îÇ   ‚îÇ       database_connection.py
‚îÇ   ‚îÇ       rabbitmq_connection.py
‚îÇ   ‚îÇ       __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄcriptografy
‚îÇ   ‚îÇ       hash_password.py
‚îÇ   ‚îÇ       __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ‚îÄdatabase_controller
‚îÇ   ‚îÇ       postgres_worker.py
‚îÇ   ‚îÇ       __init__.py
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄrabbitmq_controller
‚îÇ           rabbit_worker.py
‚îÇ			__init__.py
‚îÇ
‚îî‚îÄ‚îÄ‚îÄMS2
    ‚îÇ   docker-compose-microservice2.yml
    ‚îÇ   Dockerfile
    ‚îÇ   main.py
    ‚îÇ   requirements.txt
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄconfig
    ‚îÇ       database_connection.py
    ‚îÇ       rabbitmq_connection.py
    ‚îÇ       __init__.py
    ‚îÇ
    ‚îú‚îÄ‚îÄ‚îÄdatabase_controller
    ‚îÇ       postgres_worker.py
    ‚îÇ       __init__.py
    ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄrabbitmq_controller
            rabbit_worker.py
            __init__.py
</code></pre>]]></content>
        </item>
        
        <item>
            <title>Data Analytcs - Spotify Wrapped</title>
            <link>https://patrickpiccini.github.io/posts/spotify_wrapped/</link>
            <pubDate>Thu, 26 May 2022 09:00:50 -0300</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/spotify_wrapped/</guid>
            <description>Table of Contents  Projeto Spotify Wrapped  O que √© spotify wrapped DataSet   Exploratory Data Analysis EDA Extra√ß√£o Explora√ß√£o Limpeza de Dados Agrega√ß√£o  10 artistas mais escutados. 10 musicas mais escutadas.   Visualiza√ß√£o Storytelling   Projeto Spotify Wrapped Recentemente venho estudando a √°rea de Data Analytics, Data Science e as v√°rias deriva√ß√µes de intelig√™ncia artificial, e descobri um grande interesse por esse mundo. Foi ent√£o que decidi iniciar um pequeno projeto onde eu possa praticar meus conhecimentos adquiridos, e tamb√©m mostrar como o nosso cotidiano est√° repleto de tecnologia aplicada sobre intelig√™ncia artificial.</description>
            <content type="html"><![CDATA[<p><img src="/images/spotify_wrapped/data-analytics.jpg" alt="data-analytics"></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#projeto-spotify-wrapped">Projeto Spotify Wrapped</a>
<ul>
<li><a href="#o-que-%C3%A9-spotify-wrapped">O que √© spotify wrapped</a></li>
<li><a href="#dataset">DataSet</a></li>
</ul>
</li>
<li><a href="#exploratory-data-analysis-eda">Exploratory Data Analysis EDA</a></li>
<li><a href="#extra%C3%A7%C3%A3o">Extra√ß√£o</a></li>
<li><a href="#explora%C3%A7%C3%A3o">Explora√ß√£o</a></li>
<li><a href="#limpeza-de-dados">Limpeza de Dados</a></li>
<li><a href="#agrega%C3%A7%C3%A3o">Agrega√ß√£o</a>
<ul>
<li><a href="#abaixo-observaremos-os-10-artistas-mais-escutados">10 artistas mais escutados.</a></li>
<li><a href="#abaixo-observaremos-as-10-musicas-mais-escutadas">10 musicas mais escutadas.</a></li>
</ul>
</li>
<li><a href="#visualiza%C3%A7%C3%A3o">Visualiza√ß√£o</a></li>
<li><a href="#storytelling">Storytelling</a></li>
</ul>
<hr>
<h2 id="projeto-spotify-wrapped">Projeto Spotify Wrapped</h2>
<p>Recentemente venho estudando a √°rea de Data Analytics, Data Science e as v√°rias deriva√ß√µes de intelig√™ncia artificial, e descobri um grande interesse por esse mundo. Foi ent√£o que decidi iniciar um pequeno projeto onde eu possa praticar meus conhecimentos adquiridos, e tamb√©m mostrar como o nosso cotidiano est√° repleto de tecnologia aplicada sobre intelig√™ncia artificial.</p>
<p>O que iremos aprender:</p>
<ul>
<li>Extra√ß√£o</li>
<li>Explora√ß√£o</li>
<li>Limpeza</li>
<li>Agrega√ß√£o</li>
<li>Storytelling</li>
</ul>
<h3 id="o-que-√©-spotify-wrapped">O que √© spotify wrapped</h3>
<p>Hoje, venho mostrar um projeto utilizando a plataforma de streaming de m√∫sica mais utilizada no mundo, o Spotify. Iremos criar um recor√ßo semelhante ao que o Spotify disponibiliza, chamada &ldquo;Spotify Wrapped&rdquo;, que nada mais √© do que uma retrospectiva das m√∫sicas, artistas entro outros, mais ouvidos durante o seu ano.</p>
<p><img src="/images/spotify_wrapped/wrapped.png" alt="wrapped"></p>
<h3 id="dataset">DataSet</h3>
<p>Nesse projeto irei utilizar o meu DataSet pessoal de meu perfil do Spotify. Para conseguir as suas informa√ß√µes pessoais, basta ir nas <a href="https://www.spotify.com/br/account/privacy/">Configura√ß√µes de Privacidade</a> da sua conta, e no final da p√°gina, seguir os passos para solicita√ß√£o de seus dados. Dentro de alguns dias, voc√™ recebera por e-mail a confina√ß√£o para baixas seus dados.</p>
<p><img src="/images/spotify_wrapped/steps.png" alt="steps"></p>
<h2 id="exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</h2>
<p>O que faremos hoje, ser√° trabalha com um conceito primordial para o papel de um analista de dados, a an√°lise Explorat√≥ria de dados(EAD).</p>
<ul>
<li>A EAD √© um processo de analisar e resumir de forma detalhada um DataSet ou conjunto de dados. O objetivo √© por v√°rias t√©cnicas, extrair informa√ß√µes precisas e claras, para a extra√ß√£o de <em>insights</em>.</li>
</ul>
<p>Antes de come√ßar a analisar, importaremos as bibliotecas que iremos utilizar, e tamb√©m carregar nosso dataset.</p>
<p>Como padr√£o, o spotify disponibiliza todas as informa√ß√µes em formato JSON, como observamos no exemplo abaixo:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
  <span style="color:#f92672">&#34;endTime&#34;</span> : <span style="color:#e6db74">&#34;2021-04-29 03:33&#34;</span>,
  <span style="color:#f92672">&#34;artistName&#34;</span> : <span style="color:#e6db74">&#34;Tame Impala&#34;</span>,
  <span style="color:#f92672">&#34;trackName&#34;</span> : <span style="color:#e6db74">&#34;Let It Happen&#34;</span>,
  <span style="color:#f92672">&#34;msPlayed&#34;</span> : <span style="color:#ae81ff">345700</span>
}
</code></pre></div><h3 id="como-√≠ndices-temos">Como √≠ndices temos:</h3>
<ul>
<li>endTime - Data e hora em que o fluxo terminou no formato UTC (Fuso Hor√°rio Universal Coordenado).</li>
<li>artistName - Nome do &ldquo;criador&rdquo; para cada fluxo (por exemplo, o nome do artista se for uma faixa de m√∫sica).</li>
<li>trackName - Nome dos itens ouvidos ou assistidos (por exemplo, t√≠tulo da faixa de m√∫sica ou nome do v√≠deo).</li>
<li>msPlayed - ‚ÄúmsPlayed‚Äù- Representa quantos milissegundos a faixa foi ouvida pelo usu√°rio.</li>
</ul>
<h2 id="extra√ß√£o">Extra√ß√£o</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> pandas <span style="color:#f92672">as</span> pd
<span style="color:#f92672">import</span> seaborn <span style="color:#f92672">as</span> sns
<span style="color:#f92672">import</span> matplotlib.pyplot <span style="color:#f92672">as</span> plt
<span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> timedelta, datetime

dataframe0 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_json(<span style="color:#e6db74">&#39;./data-frame/StreamingHistory0.json&#39;</span>)
dataframe1 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_json(<span style="color:#e6db74">&#39;./data-frame/StreamingHistory1.json&#39;</span>)
dataframe2 <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_json(<span style="color:#e6db74">&#39;./data-frame/StreamingHistory2.json&#39;</span>)
<span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;dataframe0: {dataframe0.shape}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">dataframe1: {dataframe1.shape}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">dataframe2: {dataframe2.shape}&#34;</span>)
</code></pre></div><pre><code class="language-ipynb" data-lang="ipynb">dataframe0: (10000, 4)
dataframe1: (10000, 4)
dataframe2: (7154, 4)
</code></pre><p>Como quero fazer uma an√°lise completa, irei concatenar dos dataframes, transformando-os apenas em um.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>concat([dataframe0,dataframe1,dataframe2], ignore_index<span style="color:#f92672">=</span>True)
<span style="color:#66d9ef">print</span>(f<span style="color:#e6db74">&#34;Novo DataFrame: {sptf.shape}&#34;</span>)
</code></pre></div><pre><code class="language-ipynb" data-lang="ipynb">Novo DataFrame: (27154, 4)
</code></pre><p>Como podemos ver, foi concatenado os 3 dataframes, somando um total de 27154 linhas, e 4 colunas.</p>
<p>O que faremos agora, √© olhar para os dados que temos, e explorar essas informa√ß√µes que temos.</p>
<h2 id="explora√ß√£o">Explora√ß√£o</h2>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf<span style="color:#f92672">.</span>head()
</code></pre></div><p><img src="/images/spotify_wrapped/img1.png" alt="img1"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf<span style="color:#f92672">.</span>columns
</code></pre></div><pre><code class="language-iptnb" data-lang="iptnb">Index(['endTime', 'artistName', 'trackName', 'msPlayed'], dtype='object')
</code></pre><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf<span style="color:#f92672">.</span>dtypes
</code></pre></div><pre><code class="language-ipynb" data-lang="ipynb">endTime       object
artistName    object
trackName     object
msPlayed       int64
dtype: object
</code></pre><p>Nas colunas que s√£o <em>object</em> podemos pressupor serem textos, e na coluna que √© <em>int64</em> um n√∫mero inteiro.</p>
<ul>
<li>Estat√≠sticas descritivas.</li>
</ul>
<p>Para termos uma vis√£o mais panor√¢mica do nosso DataSet podemos utilizar o comando describe(). Com ele conseguimos extrair as informa√ß√µes b√°sicas como quantidade, m√©dia, minha e m√°xima, alguns percentuais e std. Esse comando visa, gerar estat√≠sticas descritivas de nosso DataSet. Tamb√©m pode ser aplicado individualmente com apenas uma coluna.</p>
<p>Como ha apenas o msPlayer como um valor num√©rico, todos esses c√°lculos ser√£o feitos apenas pobre ele.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf<span style="color:#f92672">.</span>describe()
</code></pre></div><p><img src="/images/spotify_wrapped/img2.png" alt="img2"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf<span style="color:#f92672">.</span>min()
</code></pre></div><pre><code class="language-ipynb" data-lang="ipynb">endTime                        2021-04-29 03:33
artistName                      #TeuFuturo Cast
trackName      Som de chuva - dormir, relaxar  
msPlayed                                      0
dtype: object
</code></pre><p>Como podemos notar acima, o valor m√≠nimo de msPlayed √© 0(Zero), ent√£o vamos verificar se essas informa√ß√µes est√£o corretas.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">msPlayed_zero <span style="color:#f92672">=</span> sptf<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;msPlayed &lt;= 0&#39;</span>)
msPlayed_zero<span style="color:#f92672">.</span>head(<span style="color:#ae81ff">10</span>)
</code></pre></div><p><img src="/images/spotify_wrapped/img3.png" alt="img3"></p>
<p>Ap√≥s uma pequena an√°lise, podemos notar que as m√∫sicas que tem o valor 0(zero), s√£o musicas que n√£o tiveram o seu tempo escutado contabilizado. Com isso, caso seja feita alguma an√°lise mais complexa futuramente, esses valores podem ser considerados <em>outliers</em>.</p>
<p>O que s√£o <em>outliers</em>:
S√£o valores que os diferencia drasticamente de todos os outros, ou que fogem do padr√£o dos valores, podendo causar anomalias nos resultados de algoritmos mais complexos, como uma Regress√£o Linear.</p>
<p>Vejamos isso em um grafico scatter em um  diagrama de caixa:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">plt<span style="color:#f92672">.</span>figure(figsize<span style="color:#f92672">=</span>(<span style="color:#ae81ff">12</span>, <span style="color:#ae81ff">6</span>))
plt<span style="color:#f92672">.</span>scatter(sptf[<span style="color:#e6db74">&#39;msPlayed&#39;</span>], sptf[<span style="color:#e6db74">&#39;msPlayed&#39;</span>])
plt<span style="color:#f92672">.</span>xlabel(<span style="color:#e6db74">&#39;msPlayed&#39;</span>)
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;scatter:&#39;</span>)
plt<span style="color:#f92672">.</span>show()

sns<span style="color:#f92672">.</span>boxplot(y<span style="color:#f92672">=</span>sptf[<span style="color:#e6db74">&#39;msPlayed&#39;</span>])
<span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;boxplot:&#39;</span>)
plt<span style="color:#f92672">.</span>show()
</code></pre></div><h2 id="graf1imagesspotify_wrappedgraf1png"><img src="/images/spotify_wrapped/graf1.png" alt="graf1"></h2>
<p><img src="/images/spotify_wrapped/graf2.png" alt="graf2"></p>
<p>Verificando os gr√°ficos, podemos notar uma coisa estranha. Existe um valor extremamente distante de todos os outros, um outlier. Porem como s√£o os meus dados do Spotify, me questionei &ldquo;Ser√° que tem uma m√∫sica muito a mais que todas as outras?&quot;. Foi a√≠ que fui investigar, e descobri que havia realmente escutado toda essa quantia de horas.</p>
<h3 id="mas-esses-outliers-n√£o-v√£o-desbalancear-toda-a-minha-an√°lise">Mas esses outliers n√£o v√£o desbalancear toda a minha an√°lise?</h3>
<p><img src="https://i.pinimg.com/originals/f1/85/3a/f1853a77c203e8bb4e6615ae7b62d325.gif" alt="img"></p>
<p>De certa forma sim, porem √†s vezes as informa√ß√µes que precisamos est√£o nesses outliers, e √© o nosso caso.</p>
<p>Outra coisa que percebi, √© que os dados que o spotify disponibilizou n√£o est√£o 100% corretos. Pude ver m√∫sicas que j√° ouvido muitas vezes com o msPlayed ZERADO!</p>
<p>Vacilou heim Spotfy&hellip;</p>
<p>Mas tudo bem, deixamos passar dessa vez :D.</p>
<h2 id="limpeza-de-dados">Limpeza de Dados</h2>
<p>Agora que entendemo os dados que iremos trabalhar, muitas vezes nos deparamos com informa√ß√µes inconsistentes. Ent√£o devemos executar uma s√©rie de limpeza ou altera√ß√£o dessas informa√ß√µes.</p>
<ul>
<li>Para verificar as linas com NaN use:</li>
</ul>
<p>Caso tenhamos valores valorem omissos como None, numpy.NaN, ou at√© mesmo Vazio, conseguimos identific√°-los atrav√©s do comando <em>notna()</em>, onde nos retorna a pr√≥pria tabela, porem com os valores boleanos, representando se h√° ou n√£o um valor NaN naquele √≠ndice.</p>
<ul>
<li>True  - N√£o tem NaN</li>
<li>False - Tem NaN</li>
</ul>
<p>Iremos calcular a quantia total de informa√ß√µes NaN, e como podemos ver, n√£o ha nenhum valor NaN.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf<span style="color:#f92672">.</span>notna()<span style="color:#f92672">.</span>value_counts()
</code></pre></div><pre><code class="language-ipynb" data-lang="ipynb">endTime  artistName  trackName  msPlayed
True     True        True       True        27154
dtype: int64
</code></pre><p>Como n√£o temos nenhum dado NaN, o que podemos fazer √© retirar todas as m√∫sicas que tenha o msPlayed menor ou igual a 0(zero).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">sptf <span style="color:#f92672">=</span> sptf<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;msPlayed &gt; 0&#39;</span>)

<span style="color:#75715e"># musica com menos tempo escutado</span>
sptf<span style="color:#f92672">.</span>query(<span style="color:#e6db74">&#39;msPlayed &lt;= 10&#39;</span>)
</code></pre></div><p><img src="/images/spotify_wrapped/img4.png" alt="img4"></p>
<h2 id="agrega√ß√£o">Agrega√ß√£o</h2>
<p>Na parte de agrega√ß√£o, buscamos resumir os dados atrav√©s de m√©tricas e estat√≠sticas como soma, media, etc. para extrair insigths.</p>
<ul>
<li>Insigths - √â a capacidade de tirar conclus√µes sobre os dados</li>
</ul>
<p>O que precisaremos fazer √© buscar as m√∫sicas mais ouvidas e tamb√©m os artistas mais ouvidos.</p>
<h4 id="abaixo-observaremos-os-10-artistas-mais-escutados">Abaixo observaremos os 10 artistas mais escutados.</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">artistas <span style="color:#f92672">=</span> sptf[[<span style="color:#e6db74">&#39;artistName&#39;</span>,<span style="color:#e6db74">&#39;msPlayed&#39;</span>]]<span style="color:#f92672">.</span>groupby(<span style="color:#e6db74">&#39;artistName&#39;</span>)<span style="color:#f92672">.</span>agg(<span style="color:#e6db74">&#39;sum&#39;</span>)<span style="color:#f92672">.</span>reset_index()
artistas <span style="color:#f92672">=</span> artistas<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;msPlayed&#39;</span> ,ascending<span style="color:#f92672">=</span>False)
artistas_top_10 <span style="color:#f92672">=</span> artistas[:<span style="color:#ae81ff">10</span>]
artistas_top_10
</code></pre></div><p><img src="/images/spotify_wrapped/img5.png" alt="img5"></p>
<h4 id="abaixo-observaremos-as-10-musicas-mais-escutadas">Abaixo observaremos as 10 musicas mais escutadas.</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">musicas <span style="color:#f92672">=</span> sptf<span style="color:#f92672">.</span>sort_values(by<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;msPlayed&#39;</span> ,ascending<span style="color:#f92672">=</span>False)
musicas_top_10 <span style="color:#f92672">=</span> musicas[:<span style="color:#ae81ff">10</span>]
musicas_top_10
</code></pre></div><p><img src="/images/spotify_wrapped/img6.png" alt="img6"></p>
<p>Vamos tamb√©m criar mais uma coluna como as posi√ß√£o do ranking.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">positions <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;1¬∫&#39;</span>,<span style="color:#e6db74">&#39;2¬∫&#39;</span>,<span style="color:#e6db74">&#39;3¬∫&#39;</span>,<span style="color:#e6db74">&#39;4¬∫&#39;</span>,<span style="color:#e6db74">&#39;5¬∫&#39;</span>,<span style="color:#e6db74">&#39;6¬∫&#39;</span>,<span style="color:#e6db74">&#39;7¬∫&#39;</span>,<span style="color:#e6db74">&#39;8¬∫&#39;</span>,<span style="color:#e6db74">&#39;9¬∫&#39;</span>,<span style="color:#e6db74">&#39;10¬∫&#39;</span>]

artistas_top_10[<span style="color:#e6db74">&#39;position&#39;</span>] <span style="color:#f92672">=</span> positions
musicas_top_10[<span style="color:#e6db74">&#39;position&#39;</span>] <span style="color:#f92672">=</span> positions
</code></pre></div><p>Com isso, j√° temos tudo que precisamos para fazer uma aplica√ß√£o parecida com Spotify Wrapped.</p>
<h2 id="visualiza√ß√£o">Visualiza√ß√£o</h2>
<p>Na etapa de visualiza√ß√£o, √© buscado criar gr√°ficos que melhor representem os insights, gerados por agrega√ß√£o.</p>
<p>Para ficar um pouco mais f√°cil para pessoas leigas verem essas informa√ß√µes, iremos plotar um barplot.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">chart <span style="color:#f92672">=</span> sns<span style="color:#f92672">.</span>barplot(data<span style="color:#f92672">=</span>artistas_top_10,  x<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;artistName&#39;</span>,y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;msPlayed&#39;</span>)
chart<span style="color:#f92672">.</span>set_xticklabels(chart<span style="color:#f92672">.</span>get_xticklabels(), rotation<span style="color:#f92672">=</span><span style="color:#ae81ff">90</span>)
chart<span style="color:#f92672">.</span>set(title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Top 10 Artistas&#39;</span>)
artistas_top_10
</code></pre></div><h2 id="img7imagesspotify_wrappedimg7png"><img src="/images/spotify_wrapped/img7.png" alt="img7"></h2>
<p><img src="/images/spotify_wrapped/graf3.png" alt="graf3"></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">chart <span style="color:#f92672">=</span> sns<span style="color:#f92672">.</span>barplot(data<span style="color:#f92672">=</span>musicas_top_10, x<span style="color:#f92672">=</span>positions,y<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;msPlayed&#39;</span>)
chart<span style="color:#f92672">.</span>set_xticklabels(chart<span style="color:#f92672">.</span>get_xticklabels(), size<span style="color:#f92672">=</span><span style="color:#ae81ff">10</span>)
chart<span style="color:#f92672">.</span>set(title<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;Top 10 M√∫sicas&#39;</span>)
musicas_top_10
</code></pre></div><h2 id="img8imagesspotify_wrappedimg8png"><img src="/images/spotify_wrapped/img8.png" alt="img8"></h2>
<p><img src="/images/spotify_wrapped/graf4.png" alt="graf4"></p>
<h2 id="storytelling">Storytelling</h2>
<p>Na etapa de storytelling, buscamos organizar as conclus√µes que temos dos dados, atrav√©s de um formato de hist√≥ria, para facilitar a transmiss√£o do conhecimento.</p>
<p>Baseado nos dados disponibilizados pelo Spotify, foi extra√≠do os 10 artistas mais estucados, e as 10 musicas mais escutadas no √∫ltimo ano, sendo que:</p>
<ul>
<li>1 Podcast</li>
<li>1 Autio Relaxante</li>
<li>8 M√∫sicas de diversos g√™neros</li>
</ul>
<p>Nota-se que o usu√°rio tem um gosto musical muito diversificado. Tamb√©m podemos supor que o usu√°rio possa ter alguma dificuldade para dormir, visto que a segunda m√∫sica mais ouvida √© relacionada ao relaxamento profundo para dormir mais facilmente. Tamb√©m pode-se perceber que o usu√°rio gosta de conhecimentos gerais, visto que escuta um Podcast com o foco na diversidade.</p>
<p>Portanto, recomenda-se aumentar a rela√ß√£o do usur√°rio com a plataforma, recomendando novos podcast, com o formato semelhante ao que j√° escuta. Novos sons relaxantes para manter a qualidade do sono ainda melhor, e o an√∫ncio de novos lan√ßamentos do artista &ldquo;Pineapple StormTv&rdquo;, sendo que ocupa duas posi√ß√µes de m√∫sicas mais ouvidas e est√° no Top 3 artistas mais escutados.</p>
]]></content>
        </item>
        
        <item>
            <title>Email com Google Authentication ‚Äì Refresh Token</title>
            <link>https://patrickpiccini.github.io/posts/google_auth-refresh-token/</link>
            <pubDate>Sun, 22 May 2022 18:00:00 -0300</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/google_auth-refresh-token/</guid>
            <description>Table of Contents  Introdu√ß√£o  Pr√©-requisitos   Step 1 ‚Äì Instala√ß√£o de bibliotecas Step 2 ‚Äì Leitura do token.json Step 3 ‚Äì Fun√ß√£o refresh_token Step 4 ‚Äì Fun√ß√£o request_refresh_token Step 5 ‚Äì Execu√ß√£o C√≥digo Completo Conclus√£o Refer√™ncias   Introdu√ß√£o Nesse artigo irei continuar o assunto abordado na publica√ß√£o Email com Google Authentication.
Visto que no primeiro est√°gio fizemos apenas uma autentica√ß√£o, nos deparamos com a cria√ß√£o de um arquivo chamado token.</description>
            <content type="html"><![CDATA[<p><img src="/images/google-auth/refresh_token.png" alt="refresh_token"></p>
<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introdu%C3%A7%C3%A3o">Introdu√ß√£o</a>
<ul>
<li><a href="#pr%C3%A9-requisitos">Pr√©-requisitos</a></li>
</ul>
</li>
<li><a href="#step-1--instala%C3%A7%C3%A3o-de-bibliotecas">Step 1 ‚Äì Instala√ß√£o de bibliotecas</a></li>
<li><a href="#step-2--leitura-do-tokenjson">Step 2 ‚Äì Leitura do token.json</a></li>
<li><a href="#step-3--fun%C3%A7%C3%A3o-refresh%5C_token">Step 3 ‚Äì Fun√ß√£o refresh_token</a></li>
<li><a href="#step-4--fun%C3%A7%C3%A3o-request%5C_refresh%5C_token">Step 4 ‚Äì Fun√ß√£o request_refresh_token</a></li>
<li><a href="#step-5--execu%C3%A7%C3%A3o">Step 5 ‚Äì Execu√ß√£o</a></li>
<li><a href="#c%C3%B3digo-completo">C√≥digo Completo</a></li>
<li><a href="#conclus%C3%A3o">Conclus√£o</a></li>
<li><a href="#refer%C3%AAncias">Refer√™ncias</a></li>
</ul>
<hr>
<h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>Nesse artigo irei continuar o assunto abordado na publica√ß√£o <a href="https://patrickpiccini.github.io/posts/google-auth/">Email com Google Authentication</a>.</p>
<p>Visto que no primeiro est√°gio fizemos apenas uma autentica√ß√£o, nos deparamos com a cria√ß√£o de um arquivo chamado <em>token.json.</em> Nele, est√° contido uma sequ√™ncia de informa√ß√µes, sendo elas um token de autentica√ß√£o, algumas informa√ß√µes do usu√°rio autenticado, e uma data de expira√ß√£o. Ent√£o, quando o usu√°rio utilizar a aplica√ß√£o que criamos, ele n√£o utilizar√° mais o arquivo <em>credentias.json</em>, mas sim as informa√ß√µes contidas no <em>token.json.</em></p>
<p>As informa√ß√µes contidas do <em>token.json</em> ser√£o semelhantes aos dados abaixo.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-json" data-lang="json">{
    <span style="color:#f92672">&#34;scopes&#34;</span>: [<span style="color:#e6db74">&#34;https://mail.google.com/&#34;</span>],
    <span style="color:#f92672">&#34;token_uri&#34;</span>: <span style="color:#e6db74">&#34;https://oauth2.googleapis.com/token&#34;</span>,
    <span style="color:#f92672">&#34;expiry&#34;</span>: <span style="color:#e6db74">&#34;2022-05-21T00:49:13.081000Z&#34;</span>,
    <span style="color:#f92672">&#34;token&#34;</span>: <span style="color:#e6db74">&#34;ya29.a0ARrdaM_Egt-trkKacPEcWEzCC9Lejs7DTo8VnPYRu&#34;</span>,
    <span style="color:#f92672">&#34;client_id&#34;</span>: <span style="color:#e6db74">&#34;725031891889-0533ns1pin5753k.apps.googleusercontent.com&#34;</span>,
    <span style="color:#f92672">&#34;client_secret&#34;</span>: <span style="color:#e6db74">&#34;GOCSPX-VlvdZsYe-0GXpkctKmK&#34;</span>,
    <span style="color:#f92672">&#34;refresh_token&#34;</span>: <span style="color:#e6db74">&#34;1//0h0y8XEIbzPbiCgYIARAAGBESNwF-C7yWA9JaFT_fACew&#34;</span>
}
</code></pre></div><p>Como podemos notar, nesse token que nos √© retornado h√° uma data de expira√ß√£o. Caso o usu√°rio fique enviando v√°rios e-mails durante o dia, ter√° que passar pela tela de autentica√ß√£o inumeras vezes, sendo que a Google disponibiliza apenas 4 horas de validade para cada token.</p>
<p>Visto isso, utilizaremos uma informa√ß√£o contida no <em>token.json</em> chamada refresh_token. Com ela, conseguimos criar um novo token de acesso, sem que o usu√°rio precise passar pela tela do browser.</p>
<h3 id="pr√©-requisitos">Pr√©-requisitos</h3>
<ul>
<li>
<p><a href="https://www.python.org/downloads/">Python</a> 2.6 ou superior;</p>
</li>
<li>
<p>Gerenciamento de pacotes <a href="https://pypi.org/project/pip/">PIP</a>;</p>
</li>
<li>
<p>Ter criado o c√≥digo baseado no primeiro artigo publicado (<a href="https://patrickpiccini.github.io/posts/google-auth/">Email com Google Authentication</a>).</p>
</li>
</ul>
<h3 id="step-1--instala√ß√£o-de-bibliotecas">Step 1 ‚Äì Instala√ß√£o de bibliotecas</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install --upgrade jsonlib DateTime requests
</code></pre></div><h3 id="step-2--leitura-do-tokenjson">Step 2 ‚Äì Leitura do token.json</h3>
<p>Para entender quando iremos criar um novo token de acesso, nos basear pela data de expira√ß√£o contida no arquivo. Ser√° necess√°rio apontarmos uma vari√°vel chamada <em>date_time_now</em>, que ir√° conter a data/hora atual. Ap√≥s isso, iremos ler esse <em>token.json,</em> e verificar se a data/hora atual √© maior que a data de expira√ß√£o. Caso sejam, invocaremos uma fun√ß√£o chamada de <em>refresh_token.</em></p>
<p>Todas as informa√ß√µes lidas do arquivo <em>token.json</em> ser√£o atribu√≠da √† vari√°vel <em>Info_json,</em> que passaremos como par√¢metro para a nova fun√ß√£o criada.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(<span style="color:#e6db74">&#39;token.json&#39;</span>):
        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;token.json&#39;</span>, <span style="color:#e6db74">&#39;r&#39;</span>) <span style="color:#66d9ef">as</span> verify:
            info_json <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>load(verify)

            <span style="color:#66d9ef">if</span> date_time_now <span style="color:#f92672">&gt;</span> info_json[<span style="color:#e6db74">&#39;expiry&#39;</span>]:
                refresh_token(info_json)

        creds <span style="color:#f92672">=</span> Credentials<span style="color:#f92672">.</span>from_authorized_user_file(
            <span style="color:#e6db74">&#39;token.json&#39;</span>, SCOPES)
</code></pre></div><h3 id="step-3--fun√ß√£o-refresh_token">Step 3 ‚Äì Fun√ß√£o refresh_token</h3>
<p>A fun√ß√£o refresh_token ser√° respons√°vel por requisitar √† API do Google um novo token de acesso. Dentro dessa fun√ß√£o ser√° feita toda a manipula√ß√£o de requisi√ß√£o de um novo token, adi√ß√£o de horas de expira√ß√£o, e escrita das novas informa√ß√µes dentro do arquivo j√° existente <em>token.json.</em></p>
<p>Primeiramente precisaremos criar o corpo da requisi√ß√£o, seguindo alguns padr√µes exigidos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">refresh_token</span>(info_json):
    <span style="color:#66d9ef">try</span>:
        refresh_token_obj <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#34;client_id&#34;</span>: str(info_json[<span style="color:#e6db74">&#34;client_id&#34;</span>])<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;u&#39;&#34;</span>, <span style="color:#e6db74">&#34;&#39;&#34;</span>),
            <span style="color:#e6db74">&#34;client_secret&#34;</span>: str(info_json[<span style="color:#e6db74">&#34;client_secret&#34;</span>])<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;u&#39;&#34;</span>, <span style="color:#e6db74">&#34;&#39;&#34;</span>),
            <span style="color:#e6db74">&#34;refresh_token&#34;</span>: str(info_json[<span style="color:#e6db74">&#34;refresh_token&#34;</span>])<span style="color:#f92672">.</span>replace(<span style="color:#e6db74">&#34;u&#39;&#34;</span>, <span style="color:#e6db74">&#34;&#39;&#34;</span>), 
            <span style="color:#e6db74">&#34;grant_type&#34;</span>: <span style="color:#e6db74">&#34;refresh_token&#34;</span>
        }
</code></pre></div><p>Logo abaixo, vamos reservar uma vari√°vel chamada <em>refresh_credentials</em>. para ela, posteriormente atribuiremos uma nova fun√ß√£o nomeada de <em>request_refresh_token</em>, passando como par√¢metro as informa√ß√µes que criamos na vari√°vel <em>refresh_token_obj.</em></p>
<p>Ap√≥s isso, a fun√ß√£o <em>request_refresh_token</em> retornar√° um response. Iremos carregar as informa√ß√µes em formato json na vari√°vel <em>refresh_toke_obj.</em> Separaremos mais duas informa√ß√µes, uma vari√°vel contendo a soma do hor√°rio atual + 4 horas, visto que o token √© v√°lido por quatro horas, e tamb√©m o token de acesso retornado da requisi√ß√£o <em>refresh_credentials.</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">   refresh_credentials <span style="color:#f92672">=</span> request_refresh_token(refresh_token_obj)

        refresh_toke_obj <span style="color:#f92672">=</span> json<span style="color:#f92672">.</span>loads(refresh_credentials<span style="color:#f92672">.</span>text)
        expiry_time_refresh_token <span style="color:#f92672">=</span> datetime<span style="color:#f92672">.</span>now() <span style="color:#f92672">+</span> timedelta(hours<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>)
        access_token <span style="color:#f92672">=</span> refresh_toke_obj[<span style="color:#e6db74">&#39;access_token&#39;</span>]
</code></pre></div><p>Por fim, uma exception da fun√ß√£o caso ocorra falha em alguma dessas informa√ß√µes que manipulamos.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#66d9ef">except</span> <span style="color:#a6e22e">Exception</span> <span style="color:#66d9ef">as</span> error:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Erro criacao de refresh_token.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{}&#39;</span><span style="color:#f92672">.</span>format(str(error)))
</code></pre></div><h3 id="step-4--fun√ß√£o-request_refresh_token">Step 4 ‚Äì Fun√ß√£o request_refresh_token</h3>
<p>O que abordaremos agora ser√° a fun√ß√£o itada anteriormente, <em>a request_refresh_token.</em> Nela, iremos apenas fazer uma requisi√ß√£o post para a url <a href="https://oauth2.googleapis.com/token">https://oauth2.googleapis.com/token</a>, passando as informa√ß√µes que montamos na vari√°vel <em>refresh_token_obj</em> anteriormente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">request_refresh_token</span>(refresh_token_obj):
    <span style="color:#66d9ef">try</span>:
        <span style="color:#66d9ef">return</span> requests<span style="color:#f92672">.</span>post(<span style="color:#e6db74">&#39;https://oauth2.googleapis.com/token&#39;</span>, data<span style="color:#f92672">=</span>refresh_token_obj)
</code></pre></div><p>Assim, finalizaremos com uma sequ√™ncia de poss√≠veis exce√ß√µes que podem ocorrem na requisi√ß√£o.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>Timeout <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Request Timeout exception:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{}&#39;</span><span style="color:#f92672">.</span>format(v))
        <span style="color:#66d9ef">return</span>
    <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>TooManyRedirects <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Request too many redirects exception:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{}&#39;</span><span style="color:#f92672">.</span>format(str(e)))
        <span style="color:#66d9ef">return</span>
    <span style="color:#66d9ef">except</span> requests<span style="color:#f92672">.</span>exceptions<span style="color:#f92672">.</span>RequestException <span style="color:#66d9ef">as</span> e:
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;Request exception:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">{}&#39;</span><span style="color:#f92672">.</span>format(str(e)))
        <span style="color:#66d9ef">return</span>
</code></pre></div><h3 id="step-5--execu√ß√£o">Step 5 ‚Äì Execu√ß√£o</h3>
<p>O funcionamento ser√° o mesmo mostrado no artigo <a href="https://patrickpiccini.github.io/posts/google-auth/">Email com Google Authentication</a>.
Executando o arquivo <em>SendEmail.py,</em> abrir√° uma p√°gina de sele√ß√£o de usu√°rio para autentica√ß√£o.</p>
<p><img src="/images/google-auth/img1.png" alt="img1"></p>
<p>Como meu aplicativo n√£o foi publicado, ir√° aparecer uma tela de verifica√ß√£o para aceitar o acesso as informa√ß√µes confidenciais da conta do google que desejamos autenticar.</p>
<p><img src="/images/google-auth/img2.png" alt="img2"></p>
<p><img src="/images/google-auth/img3.png" alt="img3"></p>
<p><img src="/images/google-auth/img4.png" alt="img4"></p>
<p>Ap√≥s isso, a conex√£o ser√° autenticada e o email ser√° enviado ao destinat√°rio.</p>
<p><img src="/images/google-auth/img5.png" alt="img5"></p>
<p>Depois de o usu√°rio passar por esse est√°gio de autentica√ß√£o, n√£o precisar√° mais refazer todos esses passos, visto que a atualiza√ß√£o que fizemos no c√≥digo j√° ir√° gerar novos tokens automaticamente.</p>
<h3 id="c√≥digo-completo">C√≥digo Completo</h3>
<p><a href="https://github.com/patrickpiccini/email-google-auth-2">Code - Email com Google Authentication ‚Äì Refresh Token</a></p>
<h2 id="conclus√£o">Conclus√£o</h2>
<p>Nesse artigo abordamos a segunda etapa para aplica√ß√£o de autentica√ß√£o utilizando Gmail API. Foi mostrado como verificar a validade do token de acesso atrav√©s da data de expira√ß√£o. Caso esse token esteja expirado, criamos duas novas fun√ß√µes chamadas de <em>refresh_token</em> e <em>request_refresh_token</em>, respons√°veis por requisitar um novo token de acesso, e inseri-lo no arquivo <em>token.json</em> com uma nova data de expira√ß√£o. Assim, o usu√°rio n√£o precisar√° ficar passando pelas telas de Login com o Google diversas vezes ao dia. Tudo isso a nova atualiza√ß√£o no c√≥digo far√° em back-end para o usu√°rio.</p>
<p>Refor√ßando o que citei no artigo anterior: Existem outros m√©todos de autentica√ß√£o de usu√°rio, e diferentes formas de desenvolver o c√≥digo para a autentica√ß√£o, basta saber fazer a procura certa no google que encontrar√°.</p>
<p>Espero que tenha gostado dessa publica√ß√£o, e que possa us√°-la de alguma forma em seu dia a dia.</p>
<h3 id="refer√™ncias">Refer√™ncias</h3>
<p><a href="https://support.google.com/accounts/answer/6010255?p=less-secure-apps&amp;hl=pt-BR&amp;visit_id=637824317526826001-2187211079&amp;rd=1">Apps menos seguros e a Conta do Google</a>);</p>
<p><a href="https://developers.google.com/workspace/guides/create-project">Create a Google Cloud project</a>;</p>
<p><a href="https://developers.google.com/workspace/guides/create-credentials">Create access credentials</a>;</p>
<p><a href="https://developers.google.com/gmail/api/quickstart/python">Python Quickstart</a>;</p>
<p><a href="https://developers.google.com/gmail/api/guides/sending">Sending Email</a>.</p>
]]></content>
        </item>
        
        <item>
            <title>Email com Google Authentication</title>
            <link>https://patrickpiccini.github.io/posts/google-auth/</link>
            <pubDate>Tue, 12 Apr 2022 21:00:50 -0300</pubDate>
            
            <guid>https://patrickpiccini.github.io/posts/google-auth/</guid>
            <description>Table of Contents  Introdu√ß√£o  Pr√©-Requisitos Arquitetura   Step 1 ‚Äì Criar credenciais Step 2 ‚Äì Instala√ß√£o de bibliotecas Step 3 ‚Äì Cria√ß√£o de c√≥digo de autentica√ß√£o Step 4 ‚Äì Cria√ß√£o do c√≥digo de envio de e-mail Step 5 ‚Äì Execu√ß√£o C√≥digo Completo Conclus√£o Refer√™ncias   Introdu√ß√£o Nesse artigo irei abordar uma situa√ß√£o que recentemente a Google publicou referente ao login a conta Google, utilizando somente o usu√°rio e senha para se conectar em apps de terceiros.</description>
            <content type="html"><![CDATA[<h2 id="table-of-contents">Table of Contents</h2>
<ul>
<li><a href="#introdu%C3%A7%C3%A3o">Introdu√ß√£o</a>
<ul>
<li><a href="#pr%C3%A9-requisitos">Pr√©-Requisitos</a></li>
<li><a href="#a-aplica%C3%A7%C3%A3o-ter%C3%A1-a-seguinte-arquitetura">Arquitetura</a></li>
</ul>
</li>
<li><a href="#step-1--criar-credenciais">Step 1 ‚Äì Criar credenciais</a></li>
<li><a href="#step-2--instala%C3%A7%C3%A3o-de-bibliotecas">Step 2 ‚Äì Instala√ß√£o de bibliotecas</a></li>
<li><a href="#step-3--cria%C3%A7%C3%A3o-de-c%C3%B3digo-de-autentica%C3%A7%C3%A3o">Step 3 ‚Äì Cria√ß√£o de c√≥digo de autentica√ß√£o</a></li>
<li><a href="#step-4--cria%C3%A7%C3%A3o-do-c%C3%B3digo-de-envio-de-e-mail">Step 4 ‚Äì Cria√ß√£o do c√≥digo de envio de e-mail</a></li>
<li><a href="#step-5--execu%C3%A7%C3%A3o">Step 5 ‚Äì Execu√ß√£o</a></li>
<li><a href="#c%C3%B3digo-completo">C√≥digo Completo</a></li>
<li><a href="#conclus%C3%A3o">Conclus√£o</a></li>
<li><a href="#refer%C3%AAncias">Refer√™ncias</a></li>
</ul>
<hr>
<h2 id="introdu√ß√£o">Introdu√ß√£o</h2>
<p>Nesse artigo irei abordar uma situa√ß√£o que recentemente a Google publicou referente ao login a conta Google, utilizando somente o usu√°rio e senha para se conectar em apps de terceiros. Segue um trecho da publica√ß√£o:</p>
<p><em>- &ldquo;Para proteger sua conta, o Google vai deixar de oferecer suporte para o uso de apps ou dispositivos de terceiros que solicitam login na Conta do Google usando apenas seu nome de usu√°rio e senha. Essa mudan√ßa ser√° v√°lida a partir de 30 de maio de 2022. Continue lendo para mais informa√ß√µes&rdquo; -</em> <a href="https://support.google.com/accounts/answer/6010255?p=less-secure-apps&amp;hl=pt-BR&amp;visit_id=637824317526826001-2187211079&amp;rd=1"><em>Apps menos seguros e a Conta do Google</em></a>.)</p>
<p>Tendo em vista que muitas aplica√ß√µes do mercado utilizam esse m√©todo simples de login (usu√°rio e senha), criei esse pequeno artigo explicando e desenvolvendo um m√©todo de autentica√ß√£o a conta do google, atrav√©s das APIs que o Google disponibiliza. Fazendo com que n√£o haja a necessidade de liberar nas configura√ß√µes da conta a op√ß√£o de &ldquo;permitir apps menos seguros&rdquo;</p>
<p><strong>Obs</strong>: Os exemplos de c√≥digos apresentados nesse artigo foram todos baseados nas documenta√ß√µes oficiais da Google, por√©m refartados, trazendo a clareza e a simplicidade no desenvolvimento da aplica√ß√£o.</p>
<p>Para usar a Gmail API √© necess√°rio ter uma conta na Google Cloud Plataform, onde o cadastro pode ser feito <a href="https://console.cloud.google.com/freetrial/signup/tos?_ga=2.255782728.1788355950.1649683957-1725700722.1640005169&amp;_gac=1.61556062.1649692396.CjwKCAjwo8-SBhAlEiwAopc9W-9WErTEtw9O2DIPMgtBZHRMMb8iu52gwJgAgy-YPZidJP80yxSCahoCk94QAvD_BwE">AQUI</a>.</p>
<h3 id="pr√©-requisitos">Pr√©-Requisitos</h3>
<ul>
<li>
<p><a href="https://www.python.org/downloads/">Python</a> 2.6 ou superior;</p>
</li>
<li>
<p>Gerenciamento de pacotes <a href="https://pypi.org/project/pip/">PIP</a>;</p>
</li>
<li>
<p>Um projeto na Google Cloud Platform com GmailAPI ativada. Para criar um projeto e ativar uma API, consulte <a href="https://developers.google.com/workspace/guides/create-project">Criar um projeto e ativar a API</a>.</p>
</li>
</ul>
<h4 id="a-aplica√ß√£o-ter√°-a-seguinte-arquitetura">A aplica√ß√£o ter√° a seguinte arquitetura:</h4>
<pre><code>Aplication
    ‚Ü≥ GoogleAuthenticator.py
    ‚Ü≥ SendEmail.py
    ‚Ü≥ credentials.json
</code></pre><h3 id="step-1--criar-credenciais">Step 1 ‚Äì Criar credenciais</h3>
<p>Para comunica√ß√£o da aplica√ß√£o e a API, deve ser baixado as credenciais de acesso, obtida em <strong>‚â°</strong> <em>&gt; APIs &amp; Services &gt; Credentials,</em> depois em Click <em>Create credentials &gt; API key.</em></p>
<p>Para visualizar a documenta√ß√£o oficial acesse <a href="https://developers.google.com/workspace/guides/create-credentials">Create access credentials</a>.</p>
<h3 id="step-2--instala√ß√£o-de-bibliotecas">Step 2 ‚Äì Instala√ß√£o de bibliotecas</h3>
<p>Instalar a biblioteca do Google Client.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">pip install --upgrade google-api-python-client google-auth-httplib2 google-auth-oauthlib pybase64 email-to
</code></pre></div><h3 id="step-3--cria√ß√£o-de-c√≥digo-de-autentica√ß√£o">Step 3 ‚Äì Cria√ß√£o de c√≥digo de autentica√ß√£o</h3>
<p>Criar um arquivo <em>GoogleAuthenticator.py</em>.</p>
<p>Ao abrir o arquivo, deve-se fazer uma sequ√™ncia de importa√ß√µes das bibliotecas instaladas.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> os.path
<span style="color:#f92672">from</span> google.auth.transport.requests <span style="color:#f92672">import</span> Request
<span style="color:#f92672">from</span> google.oauth2.credentials <span style="color:#f92672">import</span> Credentials
<span style="color:#f92672">from</span> google_auth_oauthlib.flow <span style="color:#f92672">import</span> InstalledAppFlow
<span style="color:#f92672">from</span> googleapiclient.discovery <span style="color:#f92672">import</span> build
<span style="color:#f92672">from</span> googleapiclient.errors <span style="color:#f92672">import</span> HttpError
</code></pre></div><p>Abaixo das importa√ß√µes, dever√° ser criado uma definition que ser√° chamara para ocorrer a autentica√ß√£o. Nela deve conter como par√¢metros, <em>client_secret_file</em>(arquivo baixado contendo as credenciais de acesso), <em>api_service_name</em>(nome do servi√ßo de API), <em>api version</em>(vers√£o da API) e <em>scopes</em>(√© respons√°vel por solicitar o acesso as APIs do Google).</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">authenticator</span>(client_secret_file, api_service_name, api_version, <span style="color:#f92672">*</span>scopes):
    CLIENT_SECRET_FILE <span style="color:#f92672">=</span> client_secret_file
    API_SERVICE_NAME <span style="color:#f92672">=</span> api_service_name
    API_VERSION <span style="color:#f92672">=</span> api_version
    SCOPES <span style="color:#f92672">=</span> [scope <span style="color:#66d9ef">for</span> scope <span style="color:#f92672">in</span> scopes[<span style="color:#ae81ff">0</span>]]

    credentials <span style="color:#f92672">=</span> None
</code></pre></div><p>A l√≥gica ser√° bem simples. Primeiro deve-se verificar se existe no diret√≥rio atual o arquivo <em>token.json,</em> que √© respons√°vel por conter em seu corpo, todas informa√ß√µes de um usu√°rio j√° autenticado pela aplica√ß√£o. Caso n√£o exista, o c√≥digo ira ler um arquivo chamado <em>credentials.json,</em> que dentro dele h√° as credenciais para a autentica√ß√£o, como <em>client_id, client_secret</em> entre outras. Ambos os arquivos s√£o atribu√≠dos a vari√°vel <strong>&ldquo;credentials&rdquo;</strong> que ser√° usado na chamada da API posteriormente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#66d9ef">if</span> os<span style="color:#f92672">.</span>path<span style="color:#f92672">.</span>exists(<span style="color:#e6db74">&#39;DocGoogle/token.json&#39;</span>):
        credentials <span style="color:#f92672">=</span> Credentials<span style="color:#f92672">.</span>from_authorized_user_file(
            <span style="color:#e6db74">&#39;DocGoogle/token.json&#39;</span>, SCOPES)
    
    <span style="color:#66d9ef">if</span> <span style="color:#f92672">not</span> credentials <span style="color:#f92672">or</span> <span style="color:#f92672">not</span> credentials<span style="color:#f92672">.</span>valid:
        <span style="color:#66d9ef">if</span> credentials <span style="color:#f92672">and</span> credentials<span style="color:#f92672">.</span>expired <span style="color:#f92672">and</span> credentials<span style="color:#f92672">.</span>refresh_token:
            credentials<span style="color:#f92672">.</span>refresh(Request())
        <span style="color:#66d9ef">else</span>:
            flow <span style="color:#f92672">=</span> InstalledAppFlow<span style="color:#f92672">.</span>from_client_secrets_file(
                CLIENT_SECRET_FILE, SCOPES)
            credentials <span style="color:#f92672">=</span> flow<span style="color:#f92672">.</span>run_local_server(port<span style="color:#f92672">=</span><span style="color:#ae81ff">0</span>)

</code></pre></div><p>Ap√≥s a autentica√ß√£o, iremos salvar as credenciais do usu√°rio autenticado no arquivo <em>token.json</em>, para que nas pr√≥ximas vezes que a aplica√ß√£o for usada, n√£o necessite passar pelo processo de autentica√ß√£o novamente.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">        <span style="color:#75715e"># Save the credentials for the next run</span>
        <span style="color:#66d9ef">with</span> open(<span style="color:#e6db74">&#39;DocGoogle/token.json&#39;</span>, <span style="color:#e6db74">&#39;w&#39;</span>) <span style="color:#66d9ef">as</span> token:
            token<span style="color:#f92672">.</span>write(credentials<span style="color:#f92672">.</span>to_json())
</code></pre></div><p>Agora, √© necess√°rio fazer uma chamada a API do google com os arquivos <em>token.json</em> ou <em>credential.json</em> que est√° na vari√°vel <strong>&ldquo;credentials&rdquo;</strong> como citado anteriormente. Com a fun√ß√£o <em>build</em> ser√° constru√≠do um Resource Object para interagir com a API, e assim, retorne a confirma√ß√£o ou rejei√ß√£o do acesso. Caso ocorra um erro na chamada a API, ser√° disparado um except para o tratamento do erro.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    <span style="color:#66d9ef">try</span>:
        <span style="color:#75715e"># Call the Gmail API</span>
        service <span style="color:#f92672">=</span> build(API_SERVICE_NAME, API_VERSION, credentials<span style="color:#f92672">=</span>credentials)
        <span style="color:#66d9ef">print</span>(API_SERVICE_NAME, <span style="color:#e6db74">&#39;service created successfully&#39;</span>)
        <span style="color:#66d9ef">return</span> service

    <span style="color:#66d9ef">except</span> HttpError <span style="color:#66d9ef">as</span> error:
        <span style="color:#75715e"># TO DO(developer) - Handle errors from gmail API.</span>
        <span style="color:#66d9ef">print</span>(<span style="color:#e6db74">&#39;An error occurred: {}&#39;</span><span style="color:#f92672">.</span>format(error))
</code></pre></div><h3 id="step-4--cria√ß√£o-do-c√≥digo-de-envio-de-e-mail">Step 4 ‚Äì Cria√ß√£o do c√≥digo de envio de e-mail</h3>
<p>Criar um arquivo <em>SendEmail.py</em>.</p>
<p>Ao abrir o arquivo, deve-se fazer uma sequ√™ncia de importa√ß√µes das bibliotecas instaladas.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> base64
<span style="color:#f92672">from</span> quickstart <span style="color:#f92672">import</span> authenticator
<span style="color:#f92672">from</span> email.mime.text <span style="color:#f92672">import</span> MIMEText
<span style="color:#f92672">from</span> googleapiclient.errors <span style="color:#f92672">import</span> HttpError
</code></pre></div><p>Nota-se que foi importado a <em>def authenticator</em> do arquivo <em>GoogleAuthenticator.py .</em></p>
<p>√â criado as vari√°veis <em>CLIENT_SECRET_FILE</em> que √© atribu√≠do o arquivo credential.json, <em>API_NAME</em> contendo o nome da aplica√ß√£o, <em>API VERSION</em> com a vers√£o, e <em>SCOPES</em> com a url para a solicita√ß√£o a API. Tudo isso √© passado como par√¢metro para a <em>def euthenticator.</em></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">CLIENT_SECRET_FILE <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;DocGoogle/credentials.json&#39;</span>
API_NAME <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;gmail&#39;</span>
API_VERSION <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;v1&#39;</span>
SCOPES <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39;https://mail.google.com/&#39;</span>]

service <span style="color:#f92672">=</span> authenticator(CLIENT_SECRET_FILE, API_NAME, API_VERSION, SCOPES)
</code></pre></div><p>Apenas com essa parte j√° se consegue criar uma autentica√ß√£o apenas executando o arquivo <em>SendEmail.py,</em> por√©m como o objetivo √© enviar um email com o usuario autenticado, continuarei mostrando o final do c√≥digo.</p>
<p>Agora √© necess√°rio criar os campos para envio de email como, Titulo, Mensagem, Remetente e Destinat√°rio.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">message <span style="color:#f92672">=</span> MIMEText(<span style="color:#e6db74">&#39;Python Mail test using API Google&#39;</span>)
message[<span style="color:#e6db74">&#39;from&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;your_email@gmail.com&#34;</span>
message[<span style="color:#e6db74">&#39;to&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;recipient@gmail.com&#39;</span>
message[<span style="color:#e6db74">&#39;subject&#39;</span>] <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;API Google&#39;</span>
raw_string <span style="color:#f92672">=</span> base64<span style="color:#f92672">.</span>urlsafe_b64encode(message<span style="color:#f92672">.</span>as_bytes())<span style="color:#f92672">.</span>decode()
</code></pre></div><p>Nesse momento √© executado o envio do email passando o response da autentica√ß√£o que est√° contida na variavel <em>service</em>, e os demais dados preenchidos. Todas essas informa√ß√µes foram codificadas em base64 para facilitar a transfer√™ncia na Internet.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#66d9ef">try</span>:
    message <span style="color:#f92672">=</span> service<span style="color:#f92672">.</span>users()<span style="color:#f92672">.</span>messages()<span style="color:#f92672">.</span>send(userId<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;me&#39;</span>, body<span style="color:#f92672">=</span>{<span style="color:#e6db74">&#39;raw&#39;</span>: raw_string})<span style="color:#f92672">.</span>execute()
    <span style="color:#66d9ef">print</span> (<span style="color:#e6db74">&#39;Message Id: {}&#39;</span>)<span style="color:#f92672">.</span>format(message[<span style="color:#e6db74">&#39;id&#39;</span>])
<span style="color:#66d9ef">except</span> HttpError <span style="color:#66d9ef">as</span> error:
     <span style="color:#66d9ef">print</span> (<span style="color:#e6db74">&#39;An error occurred: {}&#39;</span>)<span style="color:#f92672">.</span>format(error)

</code></pre></div><h3 id="step-5--execu√ß√£o">Step 5 ‚Äì Execu√ß√£o</h3>
<p>Executando o arquivo <em>SendEmail.py,</em> abrir√° uma p√°gina de sele√ß√£o de usu√°rio para autentica√ß√£o.</p>
<p><img src="/images/google-auth/img1.png" alt="img1"></p>
<p>Como meu aplicativo n√£o foi publicado, ir√° aparecer uma tela de verifica√ß√£o para aceitar o acesso as informa√ß√µes confidenciais da conta do google que desejamos autenticar.</p>
<p><img src="/images/google-auth/img2.png" alt="img2"></p>
<p><img src="/images/google-auth/img3.png" alt="img3"></p>
<p><img src="/images/google-auth/img4.png" alt="img4"></p>
<p>Ap√≥s isso, a conex√£o ser√° autenticada e o email ser√° enviado ao destinat√°rio.</p>
<p><img src="/images/google-auth/img5.png" alt="img5"></p>
<h2 id="c√≥digo-completo">C√≥digo Completo</h2>
<p><a href="https://github.com/patrickpiccini/email-google-auth">Code - Email com Google Authentication</a></p>
<h2 id="conclus√£o">Conclus√£o</h2>
<p>Nesse artigo foi abordado uma t√©cnica b√°sica de autentica√ß√£o de usu√°rio do google para aplica√ß√µes de terceiros. Com apenas as ferramentas disponibilizadas pela Google como o GmailAPI e bibliotecas python. No decorrer do desenvolvimento percebe-se a estrutura que foi utilizada √© f√°cil para ser implementada em qualquer aplica√ß√£o, basta adapt√°-la a regra de neg√≥cio.</p>
<p>Existem outros m√©todos de autentica√ß√£o de usu√°rio, e diferentes formas de desenvolver o c√≥digo para a autentica√ß√£o, basta saber fazer a procura certa no google que encontrar√°.</p>
<p>Espero que tenha gostado dessa publica√ß√£o, e que possa us√°-la de alguma forma em seu dia a dia.</p>
<h3 id="refer√™ncias">Refer√™ncias</h3>
<p><a href="https://support.google.com/accounts/answer/6010255?p=less-secure-apps&amp;hl=pt-BR&amp;visit_id=637824317526826001-2187211079&amp;rd=1">Apps menos seguros e a Conta do Google</a>);</p>
<p><a href="https://developers.google.com/workspace/guides/create-project">Create a Google Cloud project</a>;</p>
<p><a href="https://developers.google.com/workspace/guides/create-credentials">Create access credentials</a>;</p>
<p><a href="https://developers.google.com/gmail/api/quickstart/python">Python Quickstart</a>;</p>
<p><a href="https://developers.google.com/gmail/api/guides/sending">Sending Email</a>.</p>
]]></content>
        </item>
        
    </channel>
</rss>
